<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>维护人员首页</title>
    <link rel="stylesheet" href="${STATIC_URL}assets/element-2.4.11/index.css">
    <link rel="stylesheet" href="${STATIC_URL}css/maintenanceIndex/maintenanceIndex.css">
    <script type="text/javascript" src="${STATIC_URL}js/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="${STATIC_URL}assets/vue-2.5.21/vue.js"></script>
    <script type="text/javascript" src="${STATIC_URL}assets/element-2.4.11/index.js"></script>
    <script src="${STATIC_URL}assets/vue-2.5.21/axios.min.js"></script>
    <script type="text/javascript" src="${STATIC_URL}assets/echarts/echarts.js"></script>
    <script type="text/javascript" src="${STATIC_URL}assets/echarts/macarons.js"></script>
    <script type="text/javascript" src="${STATIC_URL}js/maintenanceIndex/maintenanceIndex.js"></script>

    <link rel="stylesheet" href="https://magicbox.bk.tencent.com/static_api/v3/assets/bk-icon-2.0/iconfont.css">
    <script type="text/javascript"
            src="https://magicbox.bk.tencent.com/static_api/v3/assets/dataflow-2.0/js/jsplumb.min.js"></script>
    <link rel="stylesheet"
          href="https://magicbox.bk.tencent.com/static_api/v3/assets/dataflow-2.0/css/jsPlumbToolkit-defaults.css"/>
    <script type="text/javascript" src="${STATIC_URL}js/dataflow/dataflow.js"></script>
    <link rel="stylesheet" href="${STATIC_URL}css/monitorScene/dataflow-index.css">
    <script type="text/javascript" src="${STATIC_URL}js/Component-based.js"></script>
</head>
<style>
    .key {
        line-height: 40px;
    }

    ul {
        list-style: none;
    }

    .Drigging {
        position: absolute;
    }

    .monitor_type {
        line-height: 48px;
        background: #28359324;
        text-align: center;
    }

    .monitor_list {
        display: none;
    }

    .monitor_list div {
        text-align: center;
    }

    .monitor_content {
        position: relative;
    }

    .el-row {
        border: 1px solid #ffffff;
    }

    .el-col {
        border: 1px solid #ffffff;
    }

    p, i {
        text-align: center;
    }

    .score_input {
        font-size: 16px;
        position: absolute;
        background: rgba(255, 255, 255, 0.1);
        top: -36px;
        left: 0;
        width: 50px;
        height: 36px;
        display: none;
    }

    .right_click {
        position: absolute;
        width: 100px;
        display: none;
    }

    .right_click span {
        width: 100px;
        display: inline-block;
        font-size: 16px;
        line-height: 36px;
    }
</style>

<body>
<div id="maintenanceIndex">


    <div v-if="isfram == 1">
        <el-row>
            <el-col :span="24">
                <div id="maintenanceTitle">
                    <span style="font-size: 18px;font-family: PingFangSC-Regular;color: #303133;font-weight: bold">维护人员首页</span>
                </div>
            </el-col>
        </el-row>

        <el-row>
            <el-col :span="6">
                <el-card shadow="always" class="box-card">
                    <div slot="header" class="clearfix">
                        <span class="maintenanceHeader">执行情况统计</span>
                    </div>
                    <div id="maintenancePie"></div>
                </el-card>
            </el-col>
            <el-col :span="17" :offset="1">
                <el-card shadow="always" class="box-card">
                    <div slot="header" class="clearfix">
                        <span class="maintenanceHeader">场景执行情况总览</span>
                    </div>
                    <el-row>
                        <div id="maintenanceBar"></div>
                    </el-row>
                    <el-row>
                        <el-table :data='maintenanceTableData' id="maintenanceTable">
                            <el-table-column prop="sum" label="场景总数"></el-table-column>
                            <el-table-column prop="done" label="已完成"></el-table-column>
                            <el-table-column prop="doneRate" label="完成率"></el-table-column>
                            <el-table-column prop="error" label="执行出错"></el-table-column>
                            <el-table-column prop="errorRate" label="出错率"></el-table-column>
                            <el-table-column prop="doing" label="正执行"></el-table-column>
                            <el-table-column prop="unexec" label="待执行"></el-table-column>
                        </el-table>
                    </el-row>
                </el-card>
            </el-col>
        </el-row>
        <el-row id="maintenanceStepBarRow">
            <el-col :span="13">
                <el-card shadow="always" class="box-card">
                    <div slot="header" class="clearfix">
                        <span class="maintenanceHeader">正在执行场景统计</span>
                    </div>
                    <el-row>
                        <el-col :span="20">
                            <div class="maintenanceStepBarDiv">
                                <el-steps class="maintenanceStepBar" space=100% :active="1"
                                          finish-status="success"
                                          process-status="finish">
                                    <el-step title="节点1"></el-step>
                                    <el-step title="节点2"></el-step>
                                    <el-step title="节点3"></el-step>
                                    <el-step title="节点4"></el-step>
                                    <el-step title="节点5"></el-step>
                                    <el-step title="节点6"></el-step>
                                </el-steps>
                            </div>
                            <el-button type="primary" @click="scene">点击事件</el-button>
                        </el-col>
                        <el-col :span="4">
                            <div class="maintenancePointDiv">
                                <span class="maintenancePoint">90</span>
                            </div>
                        </el-col>
                    </el-row>
                    <el-row>
                        <el-col :span="20">
                            <div class="maintenanceStepBarDiv">
                                <el-steps class="maintenanceStepBar" space=100% :active="1"
                                          finish-status="success"
                                          process-status="finish">
                                    <el-step title="节点1"></el-step>
                                    <el-step title="节点2"></el-step>
                                    <el-step title="节点3"></el-step>
                                    <el-step title="节点4"></el-step>
                                    <el-step title="节点5"></el-step>
                                    <el-step title="节点6"></el-step>
                                </el-steps>
                            </div>
                        </el-col>
                        <el-col :span="4">
                            <div class="maintenancePointDiv">
                                <span class="maintenancePoint">90</span>
                            </div>
                        </el-col>
                    </el-row>
                    <el-row>
                        <el-col :span="20">
                            <div class="maintenanceStepBarDiv">
                                <el-steps class="maintenanceStepBar" space=100% :active="1"
                                          finish-status="success"
                                          process-status="finish">
                                    <el-step title="节点1"></el-step>
                                    <el-step title="节点2"></el-step>
                                    <el-step title="节点3"></el-step>
                                    <el-step title="节点4"></el-step>
                                    <el-step title="节点5"></el-step>
                                    <el-step title="节点6"></el-step>
                                </el-steps>
                            </div>
                        </el-col>
                        <el-col :span="4">
                            <div class="maintenancePointDiv">
                                <span class="maintenancePoint">90</span>
                            </div>
                        </el-col>
                    </el-row>
                </el-card>
            </el-col>
            <el-col :span="10" :offset="1">
                <el-row>
                    <el-col :span="24">
                        <el-card shadow="always" class="box-card">
                            <div slot="header" class="clearfix">
                                <span class="maintenanceHeader">已执行场景展示</span>
                                <span class="maintenanceHeaderDesc">(以当前时间向前推3小时已执行场景情况列表包含执行状态)</span>
                            </div>
                            <el-row>
                                <el-col :span="24">
                                    <div class="maintenanceVerticalDoneDiv">
                                        <el-steps class="maintenanceVertical" direction="vertical" :active="1"
                                                  finish-status="success" process-status="finish">
                                            <el-step class="maintenanceVerticalDone"
                                                     title="2019-01-16 06:00:00"></el-step>
                                            <el-step class="maintenanceVerticalDone"
                                                     title="2019-01-16 07:00:00"></el-step>
                                            <el-step class="maintenanceVerticalDone"
                                                     title="2019-01-16 08:00:00"></el-step>
                                            <el-step class="maintenanceVerticalDone"
                                                     title="2019-01-16 09:00:00"></el-step>
                                        </el-steps>
                                    </div>
                                </el-col>
                            </el-row>
                        </el-card>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="24" id="maintenanceVerticalBarRow">
                        <el-card shadow="always" class="box-card">
                            <div slot="header" class="clearfix">
                                <span class="maintenanceHeader">待执行场景展示</span>
                                <span class="maintenanceHeaderDesc">(以当前时间向后推3小时待执行场景列表展示)</span>
                            </div>
                            <el-row>
                                <el-col :span="24">
                                    <div class="maintenanceVerticalUnexecDiv">
                                        <el-steps class="maintenanceVertical" direction="vertical" :active="1"
                                                  finish-status="success" process-status="finish">
                                            <el-step class="maintenanceVerticalUnexec"
                                                     title="2019-01-16 10:00:00"></el-step>
                                            <el-step class="maintenanceVerticalUnexec"
                                                     title="2019-01-16 11:00:00"></el-step>
                                            <el-step class="maintenanceVerticalUnexec"
                                                     title="2019-01-16 12:00:00"></el-step>
                                            <el-step class="maintenanceVerticalUnexec"
                                                     title="2019-01-16 13:00:00"></el-step>
                                        </el-steps>
                                    </div>
                                </el-col>
                            </el-row>
                        </el-card>
                    </el-col>
                </el-row>
            </el-col>
        </el-row>
    </div>

    <div v-else-if="isfram == 2">
        <div id='pagetitle' style="margin-bottom: 10px">
            场景详情
        </div>
        <hr id="hr">
        <div>
            <div style="margin-top: 20px;width: 900px;height: 900px;position: relative;" id="mychart">


            </div>
            <div>
                <el-button @click="hiden">取消</el-button>
            </div>
        </div>
    </div>


</div>
</body>
<script type="text/javascript">
    axios.interceptors.request.use((config) => {
        config.headers['X-Requested-With'] = 'XMLHttpRequest';
        let regex = /.*csrftoken=([^;.]*).*$/; // 用于从cookie中匹配 csrftoken值
        config.headers['X-CSRFToken'] = document.cookie.match(regex) === null ? null : document.cookie.match(regex)[1];
        return config
    });
    var ve = new Vue({
        el: '#maintenanceIndex',
        data: {
            maintenanceTableData: [{
                sum: 56,
                done: 8,
                doneRate: '14.29%',
                error: 6,
                errorRate: '10.71%',
                doing: 10,
                unexec: 32,
            }],
            x: 2,
            isfram: 1,
            scenes: '',
            items_data: '',
            drigging_id: 1,
            show_c: '',
        },
        methods: {
            hiden() {
                window.location.reload()
            },
            scene() {
                ve.isfram = 2
                axios.post('${SITE_URL}monitorScene/getSceneByid/' + ve.x + '/',)
                    .then((res) => {
                            ve.items_data = res.data.results
                            if (ve.items_data != '') {
                                ve.echar_pattern()
                            }
                        }
                    );
            },
            echar_pattern() {
                for (var i = 0; i < ve.items_data.length; i++) {
                    if (ve.items_data[i]['monitor_type'] == '作业单元类型') {
                        //"<div type=\""+ 'job'+ve.items_data[i]['id'] + "\" style=\"position:absolute;left:" + ve.items_data[i]['x']+'px;' + "top:" + ve.items_data[i]['y']+'px;' +"width:"+ve.items_data[i]['width']+'px;'+"height:"+ve.items_data[i]['height']+'px;'+ "\"></div>"
                        $('#mychart').append("<div type=\"" + 'job' + ve.items_data[i]['id'] + "\" style=\"position:absolute;left:" + ve.items_data[i]['x'] + 'px;' + "top:" + ve.items_data[i]['y'] + 'px;' + "width:" + ve.items_data[i]['width'] + 'px;' + "height:" + ve.items_data[i]['height'] + 'px;' + "\"></div>");
                        job_monitor(ve.items_data[i])

                    } else if (ve.items_data[i]['monitor_type'] == '图表单元类型') {
                        ve.drigging_id = ve.drigging_id + 1;
                        ve.show_c = 'show' + ve.drigging_id;
                        $('#mychart').append("<div id=\"" + ve.show_c + "\" style= \"position:absolute;left:" + ve.items_data[i]['x'] + 'px;' + "top:" + ve.items_data[i]['y'] + 'px;' + "width:" + ve.items_data[i]['width'] + 'px;' + "height:" + ve.items_data[i]['height'] + 'px;' + "\"><div></div></div>");

                        show_chart(ve.items_data[i]['id'], ve.items_data[i]['gather_params'], ve.items_data[i]['height'], ve.items_data[i]['width'], ve.show_c, ve.items_data[i]['contents'])



                    } else if (ve.items_data[i]['monitor_type'] == '流程单元类型') {
                        //$('#mychart').append("<el-col span:12>" + "<div id=\""+ve.show_c + "\"></div>"+"</el-col>");
                        ve.drigging_id = ve.drigging_id + 1;
                        flow_monitor([{"id": ve.items_data[i]['jion_id']}], ve.drigging_id = ve.drigging_id + 1)

                    } else {
                        //"<div type=\"" + 'basic'+ve.items_data[i]['id'] + "\" style=\"position:absolute;left:" + ve.items_data[i]['x'] + 'px;'+"top:" + ve.items_data[i]['y'] + 'px;' + "\"></div>"
                        $('#mychart').append("<div type=\"" + 'basic' + ve.items_data[i]['id'] + "\" style=\"position:absolute;left:" + ve.items_data[i]['x'] + 'px;' + "top:" + ve.items_data[i]['y'] + 'px;' + "\"></div>");
                        base_monitor(ve.items_data[i]['id'], ve.items_data[i]['font_size'], ve.items_data[i]['height'], ve.items_data[i]['width'], ve.items_data[i]['contents'])
                    }
                }
            },
        }
    });

</script>

</html>