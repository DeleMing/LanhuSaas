<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>title</title>

    <script src="${STATIC_URL}assets/vue-2.5.21/vue.development.js"></script>
    <link href="${STATIC_URL}assets/element-2.4.11/index.css" rel="stylesheet">
    <script src="${STATIC_URL}assets/element-2.4.11/index.js"></script>
    <script src="${STATIC_URL}assets/vue-2.5.21/axios.min.js"></script>
    <link type="text/css" href="${STATIC_URL}css/monitorScene/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/v-charts/lib/index.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/v-charts/lib/style.min.css">
    <link href="https://magicbox.bk.tencent.com/static_api/v3/bk/css/bk.css" rel="stylesheet">
    <link href="https://magicbox.bk.tencent.com/static_api/v3/assets/jrange/css/jquery.range.css" rel="stylesheet">
    <script src="https://magicbox.bk.tencent.com/static_api/v3/assets/js/jquery-1.10.2.min.js"></script>
    <script src="${STATIC_URL}js/jquery.range-min.js"></script>


    <link rel="stylesheet" href="https://magicbox.bk.tencent.com/static_api/v3/assets/bk-icon-2.0/iconfont.css">
    <script type="text/javascript"
            src="https://magicbox.bk.tencent.com/static_api/v3/assets/dataflow-2.0/js/jsplumb.min.js"></script>
    <link rel="stylesheet"
          href="https://magicbox.bk.tencent.com/static_api/v3/assets/dataflow-2.0/css/jsPlumbToolkit-defaults.css"/>
    <script type="text/javascript" src="${STATIC_URL}js/dataflow/dataflow.js"></script>
    <link rel="stylesheet" href="${STATIC_URL}css/monitorScene/dataflow-index.css">
    <script type="text/javascript" src="${STATIC_URL}js/Component-based.js"></script>
    <style>
        .Drigging {
            position:absolute;
        }
        .monitor_type{
            line-height: 48px;
            background: #28359324;
            text-align: center;
        }
        .monitor_list{
            display: none;
        }
        .monitor_list div{
            text-align: center;
        }
        .monitor_content{
            position:relative;
        }
        .el-row{
            border: 1px solid #ffffff;
        }
        .el-col{
            border: 1px solid #ffffff;
        }
        p,i{
            text-align: center;
        }
    </style>
</head>

<body>
<div id="app" style="width: 100%;height: auto;min-height: 600px">
    <el-row>
        <el-col :span="24">
            <h1 style="rgba(40, 147, 108, 0.45);line-height: 60px;text-align: center">场景编排</h1>
        </el-col>
        <el-col :span="6">
            <div style="height:auto;min-height: 600px;background: rgb(244, 244, 245)">
                <h2 class="monitor_title" style="line-height:48px;background:#283593;text-align: center;color: #ffffff">监控项</h2>
                <el-col :span="24">
                        <h3 @click="monitor_type_switch(1)" class="monitor_type" >基本监控项</h3>
                </el-col>
                <div class="monitor_list">
                    <el-col :span="12" v-for="(i,index) in base_monitor" :key="index">
                        <div @click="add_base_monitor(i)">
                            <p>{{ i.monitor_name }}</p>
                            <i class="bk-icon icon-monitors"></i>
                        </div>

                    </el-col>
                    <el-col :span="24">
                        <el-pagination :page-count="base_page_count" background layout="prev, pager, next" style="float:right"
                               @current-change="current_change1"></el-pagination>
                    </el-col>
                </div>
                <el-col :span="24">
                        <h3 @click="monitor_type_switch(2)" class="monitor_type">图表监控项</h3>
                </el-col>
                <div class="monitor_list">
                    <el-col :span="12" v-for="(i,index) in chart_monitor" :key="index">
                        <div @click="add_chart_monitor(i)">
                            <p>{{ i.monitor_name }}</p>
                            <i class="bk-icon icon-panel-permission"></i>
                        </div>
                    </el-col>
                    <el-col :span="24">
                        <el-pagination :page-count="chart_page_count" background layout="prev, pager, next" style="float:right"
                           @current-change="current_change2"></el-pagination>
                    </el-col>

                </div>
                <el-col :span="24">
                        <h3 @click="monitor_type_switch(3)" class="monitor_type">作业监控项</h3>
                </el-col>
                <div class="monitor_list">
                    <el-col :span="12" v-for="(i,index) in job_monitor" :key="index">
                        <div @click="add_job_monitor(i)">
                            <p>{{ i.monitor_name }}</p>
                            <i class="bk-icon icon-monitors"></i>
                        </div>
                    </el-col>
                    <el-col :span="24">
                        <el-pagination :page-count="job_page_count" background layout="prev, pager, next" style="float:right"
                           @current-change="current_change3"></el-pagination>
                    </el-col>

                </div>
                <el-col :span="24">
                        <h3 @click="monitor_type_switch(4)" class="monitor_type">流程监控项</h3>
                </el-col>
                <div class="monitor_list">
                    <el-col :span="12" v-for="(i,index) in flow_monitor" :key="index">
                        <div @click="add_flow_monitor(i)">
                            <p>{{ i.monitor_name }}</p>
                            <i class="bk-icon icon-monitors"></i>
                        </div>
                    </el-col>
                    <el-col :span="24">
                        <el-pagination :page-count="flow_page_count" background layout="prev, pager, next" style="float:right"
                           @current-change="current_change4"></el-pagination>
                    </el-col>

                </div>
            </div>
        </el-col>
        <el-col :span="18">
            <div class="monitor_content" style="min-height: 600px;background: rgb(244, 244, 245)">
            </div>
        </el-col>
    </el-row>
</div>


<script type="text/javascript">
        axios.interceptors.request.use((config) => {
        config.headers['X-Requested-With'] = 'XMLHttpRequest';
        let regex = /.*csrftoken=([^;.]*).*$/; // 用于从cookie中匹配 csrftoken值
        config.headers['X-CSRFToken'] = document.cookie.match(regex) === null ? null : document.cookie.match(regex)[1];
        return config
    });
    var vm = new Vue({
        el: '#app',
        data:{
            base_page_count:0,
            chart_page_count:0,
            job_page_count:0,
            flow_page_count:0,
            page:1,
            monitor_type:0,
            limit:4,
            base_monitor:[],
            chart_monitor:[],
            job_monitor:[],
            flow_monitor:[],
            drigging_id:1,
        },
        methods:{
            show(){
                axios({
                    method: 'post',
                    url: '${SITE_URL}monitorScene/scene_show/',
                    data: {
                        limit:vm.limit,
                        type:vm.monitor_type,
                        page:vm.page
                    },
                }).then((res)=> {
                    if (vm.monitor_type == 0){
                        vm.base_monitor=res.data.results.base_list;
                        vm.chart_monitor=res.data.results.chart_list;
                        vm.job_monitor=res.data.results.job_list;
                        vm.flow_monitor=res.data.results.flow_list;
                        vm.base_page_count=res.data.results.base_list[0].page_count;
                        vm.chart_page_count=res.data.results.chart_list[0].page_count;
                        vm.job_page_count=res.data.results.job_list[0].page_count;
                        vm.flow_page_count=res.data.results.flow_list[0].page_count;
                    }
                    else if (vm.monitor_type == 1) {
                        vm.base_monitor=res.data.results.base_list;
                        vm.base_page_count=res.data.results.base_list[0].page_count;
                    }
                    else if (vm.monitor_type == 2) {
                        vm.chart_monitor=res.data.results.chart_list;
                        vm.chart_page_count=res.data.results.chart_list[0].page_count;
                    }
                    else if (vm.monitor_type == 3) {
                        vm.job_monitor=res.data.results.job_list;
                        vm.job_page_count=res.data.results.job_list[0].page_count;
                    }
                    else if (vm.monitor_type == 4) {
                        vm.flow_monitor=res.data.results.flow_list;
                        vm.flow_page_count=res.data.results.flow_list[0].page_count;
                    }
                });
            },
            add_base_monitor(i){
                console.log(i);
                var job_params={
                    'job_id':i.id,
                    'width' :i.width,
                    'height':i.height,
                    'status':-1,
                }
                $('.monitor_content').append('<div class=\"Drigging\" type=\"'+i.id+'\" id=\"'+vm.drigging_id+'\"></div>')
                job_monitor(job_params)
                vm.drigging_id++
            },
            add_chart_monitor(i){
                console.log(i);
                $('.monitor_content').append('<div class=\"Drigging\" id=\"'+vm.drigging_id+'\"><div id=\"'+i.id+'\" style=\"width:'+i.height+'px;height:'+i.width+'px\"></div></div>')
                chart_monitor(i.id,i.gather_params,i.height,i.width);
                vm.drigging_id++
            },
            add_job_monitor(i){
                console.log(i);
                var job_params={
                    'job_id':i.id,
                    'width' :i.width,
                    'height':i.height,
                    'status':-1,
                }
                $('.monitor_content').append('<div class=\"Drigging\" type=\"'+i.id+'\" id=\"'+vm.drigging_id+'\"></div>')
                job_monitor(job_params)
                vm.drigging_id++
            },
            add_flow_monitor(i){
                console.log(i);
                var job_params={
                    'job_id':i.id,
                    'width' :i.width,
                    'height':i.height,
                    'status':-1,
                }
                $('.monitor_content').append('<div class=\"Drigging\" type=\"'+i.id+'\" id=\"'+vm.drigging_id+'\"></div>')
                job_monitor(job_params)
                vm.drigging_id++
            },
            current_change1(value) {
                vm.page = value;
                vm.monitor_type=1;
                vm.show();
            },
            current_change2(value) {
                vm.page = value;
                vm.monitor_type=2;
                vm.show();
            },
            current_change3(value) {
                vm.page = value;
                vm.monitor_type=3;
                vm.show();
            },
            current_change4(value) {
                vm.page = value;
                vm.monitor_type=4;
                vm.show();
            },
            monitor_type_switch(value){
                vm.monitor_type = value;
                vm.show()
            },
        }
    });
    vm.show();
    $('.monitor_type').click(function () {
        $(this).parent().next('div').animate({
           height:'toggle'
        });
        $(this).parent().next('div').siblings('.monitor_list').animate({
            height:"hide"
        });
    });
        $(function () {
        var obox=$('.monitor_content');
        var selector = '';
        var flag=false;
        var x,y;
        var offsetLeft,offsetTop;
        $(document).on("mouseover", ".Drigging", function () {
            $(this).css('cursor', 'pointer');//当鼠标移动到拖拽的p上的时候，将鼠标的样式设置为移动(move)
        });
        $(document).on("mousedown", ".Drigging", function (e) {
            var e=window.event||e;
            selector = '#' + this.id;
            flag = true;//当鼠标在移动元素按下的时候将flag设定为true
            x = e.clientX;//获取鼠标在当前窗口的相对偏移位置的Left值并赋值给x
            y = e.clientY;//获取鼠在当前窗口的相对偏移位置的Top值并赋值给y
            offsetLeft = $(selector).position().left;
            offsetTop = $(selector).position().top;
            $(this).css('cursor', 'pointer');
        });
        $(document).on("mouseup", ".Drigging", function () {
            flag = false;//当鼠标在移动元素起来的时候将flag设定为false
        });
        $(document).mousemove(function (e) {
            if (!flag)//如果flag为false则返回
                return;//当flag为true的时候执行下面的代码
            e.preventDefault();
            var e=window.event||e;
            var _x = e.clientX - x + offsetLeft;
            //event.clientX得到鼠标相对于客户端正文区域的偏移
            //然后减去offsetX即得到当前推拽元素相对于当前窗口的X值
            //（减去鼠标刚开始拖动的时候在当前窗口的偏移X）
            var _y = e.clientY - y + offsetTop;
            //event.clientY得到鼠标相对于客户端正文区域的偏移
            //然后减去offsetX即得到当前推拽元素相对于当前窗口的Y值
            //（减去鼠标刚开始拖动的时候在当前窗口的偏移Y）
            if(_x<0){
                _x=0;
            }
            if(_y<0){
                _y=0;
            }
            if(_x>obox.width()-$(selector).width()){

                _x=obox.width()-$(selector).width();
            }
            if(_y>obox.height()-$(selector).height()){
                _y=obox.height()-$(selector).height();
            }
            $(selector).css("left", _x);
            $(selector).css("top", _y);
            $(selector).css('cursor', 'pointer');


        });
        $(document).on("mousedown", ".Drigging", function (e) {
            if (3 == e.which) {
                alert('这 是右键单击事件');
            }
        });
    });
    //$('.tool-title').click(function () {
    //$(this).next('.tool-list').animate({
    //    height:'toggle'
    //});
    //$(this).parent().siblings().children('.tool-list').animate({
    //    height:"hide"
    //});
    //});
    //<p id="Drigging" class="Drigging" style="float:left">拖拽层</p>
    //<p id="Drigging1" class="Drigging" style="position: absolute;top: 150px;">拖拽层1</p>
</script>

</body>

</html>


