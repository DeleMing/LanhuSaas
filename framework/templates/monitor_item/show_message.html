<html>
<head>
    <meta charset="UTF-8">
    <script type="text/javascript" src="${STATIC_URL}js/Component-based.js"></script>
    <!-- 开发环境版本，包含了有帮助的命令行警告--2.5.51 -->
    <script src="${STATIC_URL}assets/vue-2.5.21/vue.development.js"></script>
    <!-- element UI引入样式 -->
    <link rel="stylesheet" href="${STATIC_URL}assets/element-2.4.11/index.css">
    <!-- element UI引入组件库 -->
    <script src="${STATIC_URL}assets/element-2.4.11/index.js"></script>
    <!--axios.min.js--vue.js的ajax支持-->
    <script src="${STATIC_URL}assets/vue-2.5.21/axios.min.js"></script>
    <script src="${STATIC_URL}assets/jquery/jquery-3.1.1.min.js"></script>
    <script src="${STATIC_URL}js/csrftoken.js"></script>
    <link type="text/css" href="${STATIC_URL}css/home.css" rel="stylesheet">
    <link rel="stylesheet" href="${STATIC_URL}css/net/style.min.css">

    <script type="text/javascript"
            src="${STATIC_URL}js/net/jsplumb.min.js"></script>
    <link rel="stylesheet"
          href="${STATIC_URL}css/net/jsPlumbToolkit-defaults.css"/>
    <script type="text/javascript" src="${STATIC_URL}js/dataflow/dataflow2.0.js"></script>
    <link rel="stylesheet" href="${STATIC_URL}css/monitorScene/dataflow-index.css">
    <link rel="stylesheet" href="${STATIC_URL}css/net/iconfont.css">
    <script type="text/javascript" src="${STATIC_URL}assets/echarts/echarts.js"></script>
    <script type="text/javascript" src="${STATIC_URL}assets/echarts/macarons.js"></script>
    <link rel="stylesheet" href="${STATIC_URL}css/maintenanceIndex/maintenanceIndex.css">
    <style>
        input {
            width: 250px;
            height: 30px;
        }

        .el-table--border th {
            padding: 5px
        }

        .newline {
            word-wrap: break-word;
            word-break: break-all;
            overflow: hidden;
        }

        .circle1 {
            display: inline-block;
            margin-left: 5px;
            width: 20px;
            height: 20px;
            background-color: lawngreen;
            border-radius: 50%;
            -moz-border-radius: 50%;
            -webkit-border-radius: 50%;
        }

        .circle2 {
            display: inline-block;
            margin-left: 5px;
            width: 20px;
            height: 20px;
            background-color: darkgreen;
            border-radius: 50%;
            -moz-border-radius: 50%;
            -webkit-border-radius: 50%;
        }

        .circle3 {
            display: inline-block;
            margin-left: 5px;
            width: 20px;
            height: 20px;
            background-color: grey;
            border-radius: 50%;
            -moz-border-radius: 50%;
            -webkit-border-radius: 50%;
        }

        .circle4 {
            display: inline-block;
            margin-left: 5px;
            width: 20px;
            height: 20px;
            background-color: red;
            border-radius: 50%;
            -moz-border-radius: 50%;
            -webkit-border-radius: 50%;
        }

        .asd {
            display: inline-block;
        }

        .score_input {
            font-size: 16px;
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            top: -36px;
            left: 0;
            width: 50px;
            height: 36px;
            display: none;
        }

        .right_click {
            position: absolute;
            width: 100px;
            display: none;
        }

        .right_click span {
            width: 100px;
            display: inline-block;
            font-size: 16px;
            line-height: 36px;
        }

        .circle-bar {
            margin: 20px auto;
            font-size: 100px;
            width: 1em;
            height: 1em;
            position: relative;
            background-color: #333;
        }

        .circle-bar-left, .circle-bar-right {
            width: 1em;
            height: 1em;
            background-color: #eee;
        }

        /*
            这里采用clip剪切了圆，实现左右两个半圆，右半圆在后面，因此在更上一层，
            clip的用法参考：http://www.w3school.com.cn/cssref/pr_pos_clip.asp
         */
        .circle-bar-right {
            clip: rect(0, auto, auto, .5em);
        }

        .circle-bar-left {
            clip: rect(0, .5em, auto, 0);
        }

        .mask {
            width: 0.8em;
            height: 0.8em;
            background-color: #fff;
            text-align: center;
            line-height: 0.2em;
            color: rgba(0, 0, 0, 0.5);
        }

        .mask :first-child {
            font-size: 0.3em;
            height: 0.8em;
            line-height: 0.8em;
            display: block;
        }

        /*所有的后代都水平垂直居中，这样就是同心圆了*/
        .circle-bar * {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            margin: auto;
        }

        /*自身以及子元素都是圆*/
        .circle-bar, .circle-bar > * {
            border-radius: 50%;
        }

        .dimension_div .el-form-item__content:first-child {
            margin-left: 0 !important;
        }

        /*jlq-2019-05-08-add*/
        .el-dialog__body {
            padding: 10px 20px;
            color: #606266;
            font-size: 14px;
        }

        .el-tabs--bottom .el-tabs--left .el-tabs__item:last-child, .el-tabs--bottom .el-tabs--right .el-tabs__item:last-child, .el-tabs--bottom.el-tabs--border-card .el-tabs__item:last-child, .el-tabs--bottom.el-tabs--card .el-tabs__item:last-child, .el-tabs--top .el-tabs--left .el-tabs__item:last-child, .el-tabs--top .el-tabs--right .el-tabs__item:last-child, .el-tabs--top.el-tabs--border-card .el-tabs__item:last-child, .el-tabs--top.el-tabs--card .el-tabs__item:last-child {
            padding-right: 20px;
            border-bottom: 1px;
        }

        .el-tabs--card > .el-tabs__header .el-tabs__nav {
            border: 1px solid #e4e7ed;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            width: 100%;
        }

        .el-tabs--card > .el-tabs__header .el-tabs__item.is-active {
            border-bottom-color: #fff;
            border-bottom: 1px;
        }

        .monitor-name {
            color: #f56c6c;
            font-size: 12px;
            line-height: 1;
            padding-top: 4px;
            top: 100%;
            left: 0;
        }
    </style>
</head>
<body>
<div id="app">
    <!-- div1 start-->
    <div class="div_one" style="padding: 20px 40px 0px 40px;">
        <div>
            <el-input placeholder="请输入监控名称或编辑人" clearable v-model="contents" style="width:30%" @keyup.enter.native="select1"></el-input>
            <el-button type="primary" icon="el-icon-search" v-on:click="select1">搜索</el-button>
            <el-popover placement="top-start" width="200" trigger="hover" content="新增一个监控项。" style="float:right;">
                <el-button slot="reference" v-on:click="add_unit(0)">新增</el-button>
            </el-popover>
        </div>
        <div style="height: 20px"></div>
        <div>
            <el-table :data='sites' :header-cell-style='rowclass' style="width: 100%;" border header-align="center">
                <el-table-column prop="id" label="序号" sortable></el-table-column>
                <el-table-column prop="monitor_name" show-overflow-tooltip="true" label="监控名称" sortable></el-table-column>
                <el-table-column prop="monitor_type" show-overflow-tooltip="true" label="监控类型" :formatter="format_monitor_type"
                                 sortable></el-table-column>
                <el-table-column prop="editor" label="编辑人" sortable></el-table-column>
                <el-table-column prop="edit_time" label="修改时间" sortable></el-table-column>
                <el-table-column label="操作">
                    <template slot-scope="scope">
                        <el-button size="mini" type="text" v-on:click="edit_unit(scope.row)">编辑</el-button>
                        <el-button size="mini" type="text" v-on:click="delete_unit(scope.row)">删除</el-button>
                        <el-tooltip :content="scope.row.status" placement="top">
                            <el-switch v-model="scope.row.status" active-color="#13ce66" inactive-color="#ff4949"
                                       @change="switch_change(scope.row)"
                                       active-value="1" inactive-value="0"></el-switch>
                        </el-tooltip>
                    </template>
                </el-table-column>
            </el-table>
            <el-pagination :page-count="page_count" background layout="prev, pager, next" style="float:right"
                           @current-change="current_change1" :current-page="page"></el-pagination>
        </div>
    </div>
    <!-- div1 end-->

    <!-- 对话框 start-->
    <el-dialog title="基本信息" :visible.sync="centerDialogVisible" width="80%" @closed="monitor_cache_clean"
               :close-on-click-modal="false">
        <HR align=center width=100% color=#979797 SIZE=0.5>
        <div style="height: 30px;"></div>
        <div style="margin-left: 20px;">
            <span>监控项名称</span>
            <el-input placeholder="请输入监控项名称" v-model="monitor_name" style="width: 30%;margin-left: 12px;" @blur="monitorName()"></el-input>
            <span style="margin-left: 80px;">监控项执行日历</span>
            <el-select v-model="area" placeholder="请选择日历的地区" style="width: 30%;margin-left: 12px;">
                <el-option
                        v-for="item in areas"
                        :key="item.value"
                        :label="item.area"
                        :value="item.value">
                </el-option>
            </el-select>
            <div v-if="isShow" class="monitor-name">监控项名称不能重复</div>
        </div>
        <div style="height: 30px"></div>
        <span>
            <el-tabs type="card" v-model="monitor_type">
                <!--基本单元 start-->
                <el-tab-pane :disabled="disabled2" label="基本监控项" name="first">
                    <el-row>
                        <el-col :span="12" style="margin-top: 30px"><div class="grid-content bg-purple">
                            <el-form :model="basic" ref="basic" :rules="rules1" label-width="100px">
                                <el-form-item label="字号" prop="font_size">
                                    <el-select v-model="basic.font_size" placeholder="请选择字号" @change="basic_size"
                                               style="width: 310px;">
                                        <el-option v-for="i in font_size_range" :label=i :value=i></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="高Ⅹ宽" required style="width: 96%">
                                    <el-col :span="11">
                                        <el-form-item prop="height">
                                            <el-input type="number" min="0" v-model.number="numberValidateForm.age"
                                                      auto-complete="off" v-model="basic.height"
                                                      placeholder="请输入高度" @change="basic_height"></el-input>
                                        </el-form-item>
                                    </el-col>
                                    <el-col class="line" :span="2">Ⅹ</el-col>
                                    <el-col :span="11">
                                        <el-form-item prop="width">
                                              <el-input class="max" type="number" min="0" max="600"
                                                        v-model.number="numberValidateForm.age"
                                                        auto-complete="off" v-model="basic.width"
                                                        placeholder="请输入宽度" @change="basic_width"></el-input>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>
                                <el-form-item label="显示内容" prop="contents" style="width: 96%">
                                        <el-input v-model="basic.contents" placeholder="上证指数:3000  深证指数:3000"
                                                  @change="sycontent"
                                                  type="textarea"></el-input>
                                </el-form-item>
                                <div style="margin-bottom: -18px; margin-top: -14px;">
                                    <el-form-item label="数据来源">
                                        <el-radio-group v-model="sql_file_interface" @change="change1"
                                                        style="padding: 14px">
                                            <el-radio :label="3">数据库</el-radio>
                                            <!--
                                            <el-radio :label="6">文件</el-radio>
                                            <el-radio :label="9">接口</el-radio> -->
                                         </el-radio-group>
                                    </el-form-item>
                                 </div>
                                <div :style="{ display: sql1 }">
                                    <el-form-item label="数据库连接">
                                        <el-select v-model="server_url" placeholder="请选择数据库" style="width: 310px;">
                                            <el-option v-for="i in sites1" :label="i.label"
                                                       :value="i.value"></el-option>
                                        </el-select>
                                    </el-form-item>
                                    <el-form-item label="数据采集规则" style="width: 96%">
                                        <el-input v-model="basic.gather_rule" placeholder="select * from tb_hq"
                                              type="textarea"></el-input>
                                     </el-form-item>
                                    <!--
                                    <el-form-item label="度量值">
                                        <el-select v-model="basic.measure_name" filterable placeholder="请选择指标名称"
                                                   style="width: 310px;">
                                            <el-option
                                                    v-for="item in fields"
                                                    :key="item"
                                                    :label="item"
                                                    :value="item">
                                            </el-option>
                                        </el-select>
                                    </el-form-item>
                                    <el-form-item label="展示规则" prop="show_rule_type">
                                        <el-select v-model="basic.display_type" placeholder="请选择展示规则"
                                                   @change="add_comments" style="width: 310px;">
                                            <el-option label="百分比" value="0"></el-option>
                                            <el-option label="颜色" value="1"></el-option>
                                            <el-option label="其他" value="2"></el-option>
                                        </el-select>
                                    </el-form-item>
                                    <el-form-item label="采集规则" prop="gather_rule" style="width: 90%">
                                        <el-input v-model="basic.display_rule"
                                                  placeholder="百分比：如：100|颜色：如：#000000==2@#ffffff==0|其他：如：100@ms"
                                                  type="textarea" style="width: 310px;"></el-input>
                                    </el-form-item>
                                    <div v-if="basic.display_type==1">
                                        <p style="color: #FF0000; font-size: 12px; margin-bottom: 20px">* 提示：范围区间用“-”间隔，每个范围区间占一行，数值达到此范围分别展示为绿、红、黄、灰</p>
                                    </div>
                                    <div v-if="basic.display_type==2">
                                         <p style="color: #FF0000; font-size: 12px; margin-bottom: 20px">* 提示：范围区间用“-”间隔，每个范围区间占一行，数值达到对应范围分别展示其“@”后的后缀</p>
                                    </div>
                                    -->
                                </div>
                                <div :style="{display:file1}">
                                    <el-form-item label="服务器">
                                        <el-input placeholder="请输入服务器" v-model="server_url"
                                                  style="width: 96%"></el-input>
                                    </el-form-item>
                                    <el-form-item label="文件路径">
                                        <el-input placeholder="请输入文件路径" v-model="file_param"
                                                  style="width: 96%"></el-input>
                                    </el-form-item>
                                </div>
                                <div :style="{display:interface1}">
                                    <el-form-item label="url">
                                        <el-input placeholder="请输入url" v-model="server_url"
                                                  style="width: 96%"></el-input>
                                    </el-form-item>
                                    <el-form-item label="接口参数">
                                        <el-input type="textarea" v-model="file_param"></el-input>
                                    </el-form-item>
                                </div>
                                <el-form-item label="采集时间段:" style="width: 96%">
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 142px;" v-model="basic.start_time"
                                                            placeholder="开始时间点" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                        </el-col>
                                    <el-col class="line" :span="2"
                                            style="margin-right: -4px;margin-left: 4px;">—</el-col>
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 142px;" v-model="basic.end_time"
                                                            placeholder="结束时间点" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>
                                </el-form-item>
                                <el-form-item label="采集周期" prop="period">
                                            <el-input type="number" min="0" v-model.number="numberValidateForm.age"
                                                      auto-complete="off" v-model="basic.period" style="width: 96%"
                                                      placeholder="请输入采集周期(秒)" style="width: 310px;"></el-input>
                                </el-form-item>
                                <el-form-item label="分值" prop="score">
                                            <el-input type="number" min="0" v-model.number="numberValidateForm.age"
                                                      auto-complete="off" v-model="basic.score" style="width: 96%"
                                                      @change="change4"
                                                      placeholder="请输入分值" max="100"></el-input>
                                </el-form-item>
                            </el-form>
                        </div></el-col>
                        <el-col :span="12"><div class="grid-content bg-purple-light">
                            <div style="padding: 0px 45% 0px 45%">
                                <h2>预览</h2>
                            </div>
                            <div style="text-align:center;width: 100%;min-height:40%;height: auto;background-color: whitesmoke; position: relative"
                                 id="text1">
                                <!--<div id = "text2" style="position:absolute;left:230px;top:150px;"> -->
                                <div id="text2" style="margin:auto;">
                                </div>
                            </div>
                            <div style="padding: 0px 20%">
                                <div style="height: 20px"></div>
                                <el-button type="primary" @click="basic_test">采集测试</el-button>
                            </div>
                            <div style="padding: 0px 20%">
                                <div style="height: 20px"></div>
                            </div>
                        </div></el-col>
                    </el-row>
                </el-tab-pane>
                <!-- 基本单元 end-->

                <!-- 图表单元 start
                <el-tab-pane :disabled="disabled3" label="图表监控项" name="second" style="display:none;">
                    <el-row>
                        <el-col :span="12"><div class="grid-content bg-purple">
                            <el-form :model="chart" :rules="rules2" ref="chart" label-width="100px">
                                <el-form-item label="字号" prop="font_size">
                                    <el-select v-model="chart.font_size" placeholder="请选择字号" style="width: 310px;">
                                        <el-option v-for="i in font_size_range" :label=i :value=i></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="高Ⅹ宽" required style="width: 96%">
                                    <el-col :span="11">
                                        <el-form-item prop="height">
                                            <el-input type="number" min="0" v-model.number="numberValidateForm.age"
                                                      auto-complete="off" v-model="chart.height"
                                                      placeholder="请输入高度" @change="echart_height"></el-input>
                                        </el-form-item>
                                    </el-col>
                                    <el-col class="line" :span="2">Ⅹ</el-col>
                                    <el-col :span="11">
                                        <el-form-item prop="width">
                                              <el-input type="number" min="0" v-model.number="numberValidateForm.age"
                                                        auto-complete="off" v-model="chart.width"
                                                        placeholder="请输入宽度" @change="echart_width"></el-input>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>
                                <el-form-item label="图标类型" prop="gather_params">
                                    <el-select v-model="chart.gather_params" @change="show_chart" placeholder="请选择图表类型"
                                               style="width: 310px;">
                                        <el-option label="折线图" value="折线图"></el-option>
                                        <el-option label="柱状图" value="柱状图"></el-option>
                                        <el-option label="饼图" value="饼图"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="显示内容" style="width: 96%" prop="contents">
                                    <el-input type="textarea" v-model="chart.contents"
                                              placeholder="上证指数:3000  深证指数:3000" @change="show_content"></el-input>
                                </el-form-item>
                                <el-form-item label="连接数据库">
                                    <el-select v-model="chart.params" placeholder="请选择数据库" style="width: 310px;">
                                        <el-option v-for="i in sites1" :label="i.label" :value="i.value"></el-option>

                                    </el-select>
                                </el-form-item>
                                <el-form-item label="图表采集规则" style="width: 96%">
                                    <el-input v-model="chart.gather_rule" placeholder="select * from tb_hq"
                                              type="textarea"></el-input>
                                </el-form-item>
                                <el-form-item label="采集时间段:" style="width: 96%">
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 96%" v-model="chart.start_time"
                                                            placeholder="开始时间点" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                        </el-col>
                                    <el-col class="line" :span="2">—</el-col>
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 96%" v-model="chart.end_time"
                                                            placeholder="结束时间点" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>
                                <el-form-item label="采集周期" prop="period">
                                            <el-input type="number" min="0" v-model.number="numberValidateForm.age"
                                                      auto-complete="off" v-model="chart.period" style="width: 96%"
                                                      placeholder="请输入采集周期(秒)"></el-input>
                                </el-form-item>
                            </el-form>
                        </div></el-col>
                        <el-col :span="12">
                            <div class="grid-content bg-purple-light">
                                <div style="padding: 0px 45% 0px 45%">
                                    <h2>预览</h2>
                                </div>
                                <div style="text-align:center;width: 100%;height: 23%;">
                                    <div id="maintenanceIndex">
                                        <el-row>
                                            <el-col :span="24">
                                                <el-card shadow="always" class="box-card">
                                                    <div slot="header" class="clearfix">
                                                        <span class="maintenanceHeader">{{ chart_content }}</span>
                                                    </div>
                                                    <div id="maintenancePie"></div>
                                                </el-card>
                                            </el-col>
                                        </el-row>
                                    </div>
                                </div>
                                <div style="padding: 0px 20%">
                                    <div style="height: 20px"></div>
                                    <el-button type="primary" v-on:click="chart_get_test">采集测试</el-button>
                                </div>
                            </div>
                        </el-col>
                    </el-row>
                </el-tab-pane>
                -->
                <!-- 图表单元 end-->

                <!-- 作业单元 start
                <el-tab-pane :disabled="disabled4" label="作业监控项" name="third" style="display:none;">
                    <el-row>
                        <el-col :span="12"><div class="grid-content bg-purple">
                            <el-form :model="job" :rules="rules3" ref="job" label-width="100px">
                                <el-form-item label="字号" prop="font_size">
                                    <el-select v-model="job.font_size" @change="change_job_fontSize"
                                               placeholder="请选择字号" style="width: 310px;">
                                        <el-option v-for="i in font_size_range" :label=i :value=i></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="高Ⅹ宽" required style="width: 96%">
                                    <el-col :span="11">
                                        <el-form-item prop="height">
                                            <el-input type="number" min="120" v-model.number="numberValidateForm.age"
                                                      auto-complete="off" v-model="job.height"
                                                      placeholder="请输入高度" @change="change_job_height"></el-input>
                                        </el-form-item>
                                    </el-col>
                                    <el-col class="line" :span="2">Ⅹ</el-col>
                                    <el-col :span="11">
                                        <el-form-item prop="width">
                                              <el-input type="number" min="200" v-model.number="numberValidateForm.age"
                                                        auto-complete="off" v-model="job.width"
                                                        placeholder="请输入宽度" @change="change_job_width"></el-input>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>
                                <el-form-item label="显示内容" style="width: 96%" prop="contents">
                                    <el-input type="textarea" v-model="job.contents"
                                              placeholder="上证指数:3000  深证指数:3000"
                                              @change="change_job_contents"></el-input>
                                </el-form-item>
                                <el-form-item label="作业模板" prop="gather_rule">
                                    <el-select v-model="job.gather_rule" placeholder="请选择作业模板" style="width: 310px;">
                                        <el-option v-for="i in job2" :label="i.name" :value="i.id"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="脚本参数" style="width: 96%">
                                    <el-input v-model="job.gather_params" placeholder="多个参数空格分开"></el-input>
                                </el-form-item>
                                <el-form-item label="执行服务器IP" style="width: 96%">
                                    <el-input v-model="job.params" placeholder="请输入服务器地址"></el-input>
                                </el-form-item>
                                <el-form-item label="采集时间段:" style="width: 96%">
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 96%" v-model="job.start_time"
                                                            placeholder="开始时间点" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                        </el-col>
                                    <el-col class="line" :span="2">—</el-col>
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 96%" v-model="job.end_time"
                                                            placeholder="结束时间点" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>
                                 <el-form-item label="采集周期" prop="period">
                                            <el-input type="number" min="0" v-model.number="numberValidateForm.age"
                                                      auto-complete="off" v-model="job.period" style="width: 96%"
                                                      placeholder="请输入采集周期(秒)"></el-input>
                                </el-form-item>
                            </el-form>
                        </div></el-col>
                        <el-col :span="12"><div class="grid-content bg-purple-light">
                            <div style="padding: 0px 45% 0px 45%">
                                <h2>预览</h2>
                            </div>
                            <div style="text-align:center;width: 100%;height: 23%;background-color: whitesmoke;">
                                <div style="height: 60px"></div>
                                <div id="job_text" style="max-width: 100%;margin: auto;padding-top: 20px;">

                                </div>

                            </div>
                            <div style="padding: 0px 10%">
                                <div style="height: 20px"></div>
                                <el-button type="primary" :disabled="disabled1" v-on:click="job_test">采集测试</el-button>
                                <el-checkbox v-model="checked1" @change="change2">启动脚本</el-checkbox>
                                <div :style="{ display: zuoye }">
                                    <el-alert title="启动作业可能会对系统造成不可逆的变更，请谨慎勾选此项！" type="warning" show-icon show-icon
                                              true-label="1" false-label="0"></el-alert>
                                </div>
                            </div>
                        </div></el-col>
                    </el-row>
                </el-tab-pane>
                -->
                <!-- 作业单元 end-->


                <!-- 流程单元 start
                <el-tab-pane :disabled="disabled5" label="流程监控项" name="fourth" style="display:none;">
                    <el-row>
                        <el-col :span="12"><div class="grid-content bg-purple">
                            <el-form :model="flow" :rules="rules4" ref="flow" label-width="100px">

                                <el-form-item label="流程模板" prop="gather_rule">
                                    <el-select v-model="flow.gather_rule" placeholder="请选择模板" @change="flow_change"
                                               style="width: 310px;">
                                        <el-option v-for="i in flow2" :label="i.flow_name" :value="i.id"></el-option>
                                    </el-select>
                                </el-form-item>

                                <el-form-item label="节点">
                                        <el-select v-model="flow.node_name" placeholder="请选择节点" style="width: 310px;">
                                          <el-option v-for="i in activities_node_name" :label="i.name"
                                                     :value="i.name"></el-option>
                                        </el-select>
                                 </el-form-item>


                                  <el-form-item label="采集时间段:" style="width: 96%">
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 96%" v-model="activities_node_time.start_time"
                                                            placeholder="开始时间点" @change="Rendering_start_time"
                                                            format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                        </el-col>
                                    <el-col class="line" :span="2">—</el-col>
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 96%" v-model="activities_node_time.end_time"
                                                            placeholder="结束时间点" @change="Rendering_end_time"
                                                            format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>

                                <el-form-item v-for="i in constants" :label="i.name" style="width: 96%">
                                    <el-input v-model="i.value" placeholder="请输入参数"></el-input>
                                </el-form-item>


                                <el-form-item label="字号" prop="font_size">
                                    <el-select v-model="flow.font_size" placeholder="请选择字号" @change="font_size"
                                               style="width: 310px;">
                                        <el-option v-for="i in font_size_range" :label=i :value=i></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="高Ⅹ宽" required style="width: 96%">
                                    <el-col :span="11">
                                        <el-form-item prop="height">
                                            <el-input disabled="disabled" type="number" min="0"
                                                      v-model.number="numberValidateForm.age" auto-complete="off"
                                                      v-model="flow.height" placeholder="请输入高度"
                                                      @change="flow_height"></el-input>
                                        </el-form-item>
                                    </el-col>
                                    <el-col class="line" :span="2">Ⅹ</el-col>
                                    <el-col :span="11">
                                        <el-form-item prop="width">
                                              <el-input type="number" min="0" v-model.number="numberValidateForm.age"
                                                        auto-complete="off" v-model="flow.width" placeholder="请输入宽度"
                                                        @change="flow_width" disabled="disabled"></el-input>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>

                                <div v-if="flow.gather_params.id === '1'">
                                <el-form-item label="节点周期:" style="width: 96%">
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 96%" v-model="flow.start_time"
                                                            placeholder="开始时间点" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                        </el-col>
                                    <el-col class="line" :span="2">—</el-col>
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 96%" v-model="flow.end_time"
                                                            placeholder="结束时间点" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>
                                </div>
                                <div v-if="flow.gather_rule === '1'">
                                <el-form-item label="节点周期:" style="width: 96%">
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 96%" v-model="flow.start_time"
                                                            placeholder="开始时间点1" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                        </el-col>
                                    <el-col class="line" :span="2">—</el-col>
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 96%" v-model="flow.end_time"
                                                            placeholder="结束时间点" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>
                                </div>
                                 <el-form-item label="采集周期" prop="period">
                                            <el-input type="number" min="0" id="period"
                                                      v-model.number="numberValidateForm.age"
                                                      auto-complete="off" v-model="flow.period" style="width: 96%"
                                                      placeholder="请输入采集周期(秒)"></el-input>
                                </el-form-item>
                            </el-form>
                        </div></el-col>
                        <el-col :span="12"><div class="grid-content bg-purple-light">
                            <div style="padding: 0px 45% 0px 45%">
                                <h2>预览</h2>
                            </div>
                            <div id="flow_canvas" style="text-align:center;width: 100%;height: 26%;overflow: scroll;">
                                <div id="flow1" class="clearfix workflow-box" style="width:1000px;position: relative;">

                                        <div class="workflow-canvas" style="margin-left: 0px;padding-left: 0px">

                                            <div class="jtk-content">
                                                <div class="jtk-demo-canvas canvas-wide jtk-surface jtk-surface-nopan"
                                                     id="canvas" style="height:500px">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="jtk-delete jtk-none ">删除节点</div>
                                        <div id="template" class="jtk-none">
                                            <div class="jtk-window jtk-node workfolw-node start-node" id="{charts}"
                                                 data-type="EmptyEndEvent">
                                               <div class="node-wrapper">
                                                    <img src="${STATIC_URL}img/canvas/endpoint.png"
                                                         style="top: 5px;left: 20px;position: absolute;">
                                                </div>
                                            </div>
                                             <div class="jtk-window jtk-node workfolw-node start-node" id="{charts}"
                                                  data-type="EmptyStartEvent">
                                                <div class="node-wrapper">
                                                    <img src="${STATIC_URL}img/canvas/Start.png"
                                                         style="top: 5px;left: 20px;position: absolute;">
                                                </div>
                                            </div>
                                            <div class="jtk-window jtk-node workfolw-node database-node" id="{charts}"
                                                 data-type="ServiceActivity">
                                                <div class="node-wrapper">
                                                    <div class="node-content" style="position: relative">
                                                        <div class="start_time"
                                                             style="position: absolute;width: 70px;height: 20px;top: -26px;left: 0px;"></div>
                                                        <div class="end_time"
                                                             style="position: absolute;width: 70px;height: 20px;top: -26px;right: 0px;"></div>
                                                        <p class="node-title"
                                                           style=" overflow: hidden;text-overflow:ellipsis;white-space: nowrap;"></p>
                                                    </div>
                                                    <div class="node-icon" style="top: 26px;width: 100%;height: 100%;">
                                                        <span class="title"
                                                              style="top: -14px;height: 100%;position: relative;color: #F4FFF9; overflow: hidden;text-overflow:ellipsis;white-space: nowrap;"></span>
                                                    </div>
                                                </div>
                                            </div>
                                           <div class="jtk-window jtk-node workfolw-node start-node" id="{charts}"
                                                data-type="ConvergeGateway">
                                                 <div class="node-wrapper">
                                                    <img src="${STATIC_URL}img/canvas/convergegateway.png">
                                                </div>
                                            </div>
                                            <div class="jtk-window jtk-node workfolw-node start-node" id="{charts}"
                                                 data-type="ParallelGateway">
                                                <div class="node-wrapper">
                                                    <img src="${STATIC_URL}img/canvas/ParallelGateway.png">
                                                </div>
                                            </div>
                                            <div class="jtk-window jtk-node workfolw-node cog-node" id="{charts}"
                                                 data-type="dataCog">
                                                <div class="node-wrapper">
                                                    <div class="node-content">
                                                        <p class="node-title"></p>
                                                    </div>
                                                    <div class="node-icon">
                                                        <i class="bk-icon icon-cog"></i>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="jtk-window jtk-node workfolw-node filter-node" id="{charts}"
                                                 data-type="dataFilter">
                                                <div class="node-wrapper">
                                                    <div class="node-content">
                                                        <p class="node-title"></p>
                                                    </div>
                                                    <div class="node-icon">
                                                        <i class="bk-icon icon-circle"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                            </div>
                            <div style="padding: 0px 10%">
                                <div style="height: 20px"></div>
                                <el-button type="primary" v-on:click="canvas_new" :disabled="disabled1">采集测试</el-button>
                                <el-checkbox v-model="checked2" @change="change3">启动流程</el-checkbox>
                                <div :style="{ display: liucheng }">
                                    <el-alert title="启动流程可能会对系统造成不可逆的变更，请谨慎勾选此项！" type="warning" show-icon
                                              true-label="1" false-label="0"></el-alert>
                                </div>
                            </div>
                        </div></el-col>
                    </el-row>
                </el-tab-pane>
                -->
                <!-- 流程单元 end-->

                <!-- 基本单元 start-->
                <el-tab-pane :disabled="disabled6" label="基本监控项（一体化平台）" name="five" element-loading-text="拼命加载中"
                             element-loading-spinner="el-icon-loading"
                             element-loading-background="rgba(0, 0, 0, 0.8)" v-loading="loading">
                    <el-row>
                        <el-col :span="12">
                            <div class="grid-content bg-purple">
                                <el-form :model="base" ref="base" :rules="basicMonitorRules" label-width="100px">
                                <el-form-item label="字号" prop="font_size">
                                    <el-select v-model="base.font_size" placeholder="请选择字号" @change="base_size"
                                               style="width: 310px;">
                                        <el-option v-for="i in font_size_range" :label=i :value=i></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="高Ⅹ宽" required style="width: 96%">
                                    <el-col :span="11">
                                        <el-form-item prop="height">
                                            <el-input type="number" min="0" v-model.number="numberValidateForm.age"
                                                      auto-complete="off" v-model="base.height"
                                                      placeholder="请输入高度" @change="base_height_change"></el-input>
                                        </el-form-item>
                                    </el-col>
                                    <el-col class="line" :span="2">Ⅹ</el-col>
                                    <el-col :span="11">
                                        <el-form-item prop="width">
                                              <el-input class="max" type="number" min="0" max="600"
                                                        v-model.number="numberValidateForm.age"
                                                        auto-complete="off" v-model="base.width"
                                                        placeholder="请输入宽度" @change="base_width_change"></el-input>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>
                                <el-form-item label="显示内容" prop="contents" style="width: 96%">
                                        <el-col :span="20">
                                        <el-input v-model="base.contents" placeholder="上证指数:3000  深证指数:3000"
                                                  @change="content_modified_change"
                                                  type="textarea" style="width: 230px;"></el-input>
                                        </el-col>
                                    <el-col :span="4">
                                    <el-button type="primary" size="mini"
                                               @click="base_monitor_show_reset">默认</el-button>
                                    </el-col>
                                </el-form-item>
                                <el-form-item label="数据来源">
                                    <el-radio-group v-model="sql_file_interface" @change="change_data_sources"
                                                    style="padding: 14px">
                                        <el-radio :label="9">接口</el-radio>
                                     </el-radio-group>
                                </el-form-item>

                                    <div v-if="file_show">
                                        <div :style="{ display: sql1 }">
                                    <el-form-item label="数据库连接">
                                        <el-select v-model="server_url" placeholder="请选择数据库">
                                            <el-option v-for="i in sites1" :label="i.label"
                                                       :value="i.value"></el-option>
                                        </el-select>
                                    </el-form-item>
                                </div>
                                <div :style="{display:file1}">
                                    <el-form-item label="服务器">
                                        <el-input placeholder="请输入服务器" v-model="server_url"
                                                  style="width: 96%"></el-input>
                                    </el-form-item>
                                    <el-form-item label="文件路径">
                                        <el-input placeholder="请输入文件路径" v-model="file_param"
                                                  style="width: 96%"></el-input>
                                    </el-form-item>
                                </div>
                                <div :style="{display:interface1}">
                                    <el-form-item label="url">
                                        <el-input placeholder="请输入url" v-model="server_url"
                                                  style="width: 96%"></el-input>
                                    </el-form-item>
                                    <el-form-item label="接口参数">
                                        <el-input type="textarea" v-model="file_param"></el-input>
                                    </el-form-item>
                                </div>
                                <el-form-item label="数据采集规则" style="width: 96%">
                                    <el-input v-model="basic.gather_rule" placeholder="select * from tb_hq"
                                              type="textarea"></el-input>
                                </el-form-item>
                                <el-form-item label="采集时间段:" style="width: 96%">
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 96%" v-model="basic.start_time"
                                                            placeholder="开始时间点" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                        </el-col>
                                    <el-col class="line" :span="2">—</el-col>
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 96%" v-model="basic.end_time"
                                                            placeholder="结束时间点" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>
                                        </el-form-item>
                                        <el-form-item label="采集周期" prop="period">
                                            <el-input type="number" min="0" v-model.number="numberValidateForm.age"
                                                      auto-complete="off" v-model="basic.period" style="width: 96%"
                                                      placeholder="请输入采集周期(秒)"></el-input>
                                        </el-form-item>
                                    </div>
                                    <div v-if="database_show">
                                        <div :style="{ display: sql1 }">
                                    <el-form-item label="数据库连接">
                                        <el-select v-model="server_url" placeholder="请选择数据库">
                                            <el-option v-for="i in sites1" :label="i.label"
                                                       :value="i.value"></el-option>
                                        </el-select>
                                    </el-form-item>
                                </div>
                                <div :style="{display:file1}">
                                    <el-form-item label="服务器">
                                        <el-input placeholder="请输入服务器" v-model="server_url"
                                                  style="width: 96%"></el-input>
                                    </el-form-item>
                                    <el-form-item label="文件路径">
                                        <el-input placeholder="请输入文件路径" v-model="file_param"
                                                  style="width: 96%"></el-input>
                                    </el-form-item>
                                </div>
                                <div :style="{display:interface1}">
                                    <el-form-item label="url">
                                        <el-input placeholder="请输入url" v-model="server_url"
                                                  style="width: 96%"></el-input>
                                    </el-form-item>
                                    <el-form-item label="接口参数">
                                        <el-input type="textarea" v-model="file_param"></el-input>
                                    </el-form-item>
                                </div>
                                <el-form-item label="数据采集规则" style="width: 96%">
                                    <el-input v-model="basic.gather_rule" placeholder="select * from tb_hq"
                                              type="textarea"></el-input>
                                </el-form-item>
                                <el-form-item label="采集时间段:" style="width: 96%">
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 96%" v-model="basic.start_time"
                                                            placeholder="开始时间点" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                        </el-col>
                                    <el-col class="line" :span="2">—</el-col>
                                    <el-col :span="11">
                                        <el-form-item>
                                            <el-time-picker style="width: 96%" v-model="basic.end_time"
                                                            placeholder="结束时间点" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>
                                        </el-form-item>
                                        <el-form-item label="采集周期" prop="period">
                                            <el-input type="number" min="0" v-model.number="numberValidateForm.age"
                                                      auto-complete="off" v-model="basic.period" style="width: 96%"
                                                      placeholder="请输入采集周期(秒)"></el-input>
                                        </el-form-item>
                                    </div>
                             <div v-if="interface_show">
                                <el-form-item label="来源类型" prop="interface_type">
                                    <el-select v-model="base.interface_type" placeholder="请选择数据来源类型"
                                               @change="change_source_type" style="width: 310px;">
                                        <el-option label="指标" value="measures"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="来源名称" prop="measures">
                                    <el-select v-model="base.measures" filterable placeholder="请选择指标集"
                                               @change="change_measures" style="width: 310px;">
                                        <el-option
                                                v-for="item in iqube_name"
                                                :key="item.value"
                                                :label="item.value"
                                                :value="item.value">
                                        </el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="度量值" prop="measures_name">
                                    <el-select v-model="base.measures_name" filterable placeholder="请选择指标名称"
                                               style="width: 310px;">
                                        <el-option
                                                v-for="item in metric_list"
                                                :key="item"
                                                :label="item"
                                                :value="item">
                                        </el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="展示规则" prop="show_rule_type">
                                    <el-select v-model="base.show_rule_type" placeholder="请选择展示规则"
                                               @change="add_comments" style="width: 310px;">
                                        <el-option label="百分比" value="0"></el-option>
                                        <el-option label="颜色" value="1"></el-option>
                                        <el-option label="其他" value="2"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="采集规则" prop="gather_rule" style="width: 90%">
                                    <el-input v-model="base.gather_rule"
                                              placeholder="百分比：如：100|颜色：如：#000000==2@#ffffff==0|其他：如：100@ms"
                                              type="textarea" style="width: 310px;"></el-input>
                                </el-form-item>
                                 <div v-if="color_rules_comments">
                                     <p style="color: #FF0000; font-size: 12px; margin-bottom: 20px">* 提示：范围区间用“-”间隔，每个范围区间占一行，数值达到此范围分别展示为绿、红、黄、灰</p>
                                 </div>
                                 <div v-if="other_rules_comments">
                                     <p style="color: #FF0000; font-size: 12px; margin-bottom: 20px">* 提示：范围区间用“-”间隔，每个范围区间占一行，数值达到对应范围分别展示其“@”后的后缀</p>
                                 </div>
                                <el-form-item label="采集时间段:" style="width: 96%">
                                    <el-col :span="11">
                                        <el-form-item prop="start_time">
                                            <el-time-picker style="width: 96%" v-model="base.start_time"
                                                            placeholder="开始时间点" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                        </el-col>
                                    <el-col class="line" :span="2">—</el-col>
                                    <el-col :span="11">
                                        <el-form-item prop="end_time">
                                            <el-time-picker style="width: 96%" v-model="base.end_time"
                                                            placeholder="结束时间点" format="HH:mm" value-format="HH:mm">
                                            </el-time-picker>
                                        </el-form-item>
                                    </el-col>
                                </el-form-item>
                                <el-form-item label="采集周期" prop="period">
                                    <el-input type="number" min="0" v-model.number="numberValidateForm.age"
                                              auto-complete="off" v-model="base.period" style="width: 96%"
                                              placeholder="请输入采集周期(秒)"></el-input>
                                </el-form-item>
                                  <el-form-item label="分值" prop="score">
                                            <el-input type="number" min="0" v-model.number="numberValidateForm.age"
                                                      auto-complete="off" v-model="base.score" style="width: 96%"
                                                      @change="change4"
                                                      placeholder="请输入分值" max="100"></el-input>
                                </el-form-item>
                                <el-col :span="24">
                                    <el-form-item v-for="(i,index) in base.dimension_data" class="dimension_div">
                                    <el-col :span="11">
                                        <el-form-item label="维度名称" :prop="'dimension_data.'+ index +'.dimension_name'"
                                                      :rules="basicMonitorRules.dimension_data.dimension_name">
                                            <el-select v-model="i.dimension_name">
                                                <el-option :label="i" :value="i"
                                                           v-for="(i,index) in dimension_list"></el-option>
                                            </el-select>
                                        </el-form-item>
                                    </el-col>
                                    <el-col :span="11">
                                        <el-form-item label="维度值" :prop="'dimension_data.'+ index +'.dimension_value'"
                                                      :rules="basicMonitorRules.dimension_data.dimension_value">
                                            <el-input v-model="i.dimension_value">
                                            </el-input>
                                        </el-form-item>
                                    </el-col>
                                    <el-col :span="2">
                                        <el-button type="danger" @click="delete_dimension(index)"
                                                   style="width: 68px;padding: 10px;margin: 2px 10px;"><i
                                                class="el-icon-remove-outline"
                                                style="font-size: 14px;"></i>&nbsp;删除</el-button>
                                    </el-col>
                                </el-form-item>
                                </el-col>
                                <el-col :span="6" :offset="18" style="height: 48px">
                                    <el-button type="primary" @click="add_dimension"><i
                                            class="el-icon-circle-plus-outline"
                                            style="font-size: 14px"></i>&nbsp;添加维度</el-button>
                                </el-col>
                             </div>

                            </el-form>
                            </div>
                        </el-col>
                        <el-col :span="12"><div class="grid-content bg-purple-light">
                            <div>
                            <div style="padding: 0px 45% 0px 45%">
                                <h2>预览</h2>
                            </div>
                            <div style="text-align:center;width: 100%;min-height:40%;height: auto;background-color: whitesmoke; position: relative"
                                 id="base_test_text" v-loading="preview_loading">

                                </div>
                            </div>
                            <div style="padding: 0px 20%">
                                <div style="height: 20px"></div>
                                <el-button type="primary" @click="base_cell_test">采集测试</el-button>
                            </div>
                            <div style="padding: 0px 20%">
                                <div style="height: 20px"></div>
                            </div>
                        </div></el-col>
                    </el-row>
                </el-tab-pane>
                <!-- 基本单元 end-->
            </el-tabs>
        </span>
        <span slot="footer" class="dialog-footer">
            <el-button @click="centerDialogVisible = false">取 消</el-button>
            <el-button type="primary" v-on:click="pefFrom">保 存</el-button>
        </span>
    </el-dialog>
    <!-- 对话框 end-->
</div>
</body>


<script>
    //csrf验证
    axios.interceptors.request.use((config) => {
        config.headers['X-Requested-With'] = 'XMLHttpRequest';
        let regex = /.*csrftoken=([^;.]*).*$/; // 用于从cookie中匹配 csrftoken值
        config.headers['X-CSRFToken'] = document.cookie.match(regex) === null ? null : document.cookie.match(regex)[1];
        return config
    });
    //自定义校验规则
    //基本监控项高度大小范围校验
    const height_range_check = (rule, value, callback) => {
        var reg = /^[0-9]*$/;
        if (!reg.test(value)) {
            return callback(new Error('高度值必须是一个数字'));
        }
        var height = parseInt(value);
        if (0 > height || 480 < height) {
            return callback(new Error('高度值范围在0-480'));
        }
        return callback();
    };

    const width_range_check = (rule, value, callback) => {
        var reg = /^[0-9]*$/;
        if (!reg.test(value)) {
            return callback(new Error('宽度值必须是一个数字'));
        }
        var height = parseInt(value);
        if (0 > height || 422 < height) {
            return callback(new Error('宽度值范围在0-422'));
        }
        return callback();
    };

    var vm = new Vue({
        el: '#app',
        data: {
            //预览加载变量
            preview_loading: false,
            //基本监控项（修改后）显示内容缓存，显示所有指标
            base_monitor_show_cache: '',
            //颜色采集规则注释
            color_rules_comments: false,
            //其他采集规则注释
            other_rules_comments: false,
            //基本监控项（修改后）添加的情况下是否为第一次加载数据的标记
            base_monitor_add_init: true,
            //基本监控项（修改后）编辑的情况下是否为第一次加载数据标记
            base_monitor_edit_init: true,
            //基本监控项（修改后）添加后是否为第一次采集测试的标记
            base_monitor_add_test_init: true,
            //基本监控项（修改后）修改后是否为第一次采集测试的标记
            base_monitor_edit_test_init: true,
            //基本监控项上传数据
            base_monitor_upload_data: {},
            //采集测试数据缓存变量
            gather_test_data: null,
            //采集测试数据标记位，默认为null，采集数据成功置true，采集失败置false
            gather_data_test_flag: null,
            database_show: true,
            file_show: false,
            interface_show: false,
            loading: false,
            message: '',                                           //弹框提示信息
            constants: '',
            unit_id1: 0,
            location: '',
            line: '',
            old_html: '',
            msg1: '',
            sql_id: '',
            template_list: {
                name: '',
                id: ''
            },
            add_pamas: 0,                                        //新增编辑判断
            font_size_range: [2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 38, 40],   //字体大小
            job2: [],                                   //作业模板
            flow2: [],                                  //流程模板
            activities_node_name: [],                    //节点名称
            activities_node_time: {                      //节点时间
                start_time: '',                      //开始时间
                end_time: '',                        //结束时间
            },
            page_count: 100,                            //总页码数
            page: 1,                                    //分页页码数
            sites: [],                                  //table内容
            sites1: [],
            contents: '',                               //搜索输入框内容
            checked1: false,                           //作业启动选框
            checked2: false,                           //流程启动选框
            disabled1: false,
            disabled2: false,                            //基本单元
            //disabled3: false,                            //图表单元
            //disabled4: false,                            //作业单元
            //disabled5: false,                            //流程单元
            disabled6: false,
            isShow:false,
            areas: [],
            area: 1,
            caiji1: 'block',
            caiji2: 'none',
            monitor_name: '',                             //单元名称
            unit_id: 0,                                   //单元id
            centerDialogVisible: false,                  //弹窗状态
            sql1: 'block',
            file1: 'none',
            interface1: 'none',
            sql_file_interface: 3,
            server_url: '',
            file_param: '',
            param1: '',
            param2: '',
            zuoye: 'none',
            liucheng: 'none',
            basic_show_content: "",
            fields: [],                                  //字段选择数组
            result_data: {},                            //传递新增数据
            monitor_type: 'first',                     //单元类型
            basic: {                                   //基本单元
                monitor_name: '',                      //单元名称
                monitor_type: '',                      //单元类型
                font_size: '20',                         //字号
                height: '20',                            //高度
                width: '0',                             //宽度
                start_time: '',                        //开始时间
                end_time: '',                          //结束时间
                period: '10',                            //采集周期
                params: '',                            //监控参数
                status: '',                            //监控状态
                contents: '',                          //显示内容
                gather_rule: '',                       //采集规则
                gather_params: 'sql',                  //采集参数
                monitor_area: '',                             //日历地区
                score: '1',                                //分值
            },
            base: {
                //基本单元
                dimension_data: [],//维度名称
                measures_name: '',//指标名称
                measures: '',       //指标集
                interface_type: '',//接口类型
                show_rule_type: '',//展示规则
                monitor_name: '',                      //单元名称
                monitor_type: '',                      //单元类型
                font_size: '20',                         //字号
                height: '480',                            //高度
                width: '422',                             //宽度
                start_time: '',                        //开始时间
                end_time: '',                          //结束时间
                period: '10',                            //采集周期
                params: '',                            //监控参数
                status: '',                            //监控状态
                contents: '',                          //显示内容
                gather_rule: '',                       //采集规则
                gather_params: 'sql',                  //采集参数
                monitor_area: '',                             //日历地区
                score: ''                                //分值
            },             //基本单元
            rules1: {
                font_size: [
                    {required: true, message: '请选择字号', trigger: 'change'}
                ],
                height: [
                    {required: true, message: '请输入高度', trigger: 'blur'}
                ],
                width: [
                    {required: true, message: '请输入宽度', trigger: 'blur'}
                ],
                contents: [
                    {required: true, message: '请输入内容', trigger: 'blur'}
                ],
                period: [
                    {required: true, message: '请输入采集周期(以秒为单位)', trigger: 'blur'}
                ],
                score: [
                    {required: true, message: '请输入分值', trigger: 'blur'}
                ]
            },                              //校验规则
            chart: {                                //图表单元
                monitor_name: '',                    //单元名称
                monitor_type: '',                    //单元类型
                font_size: '20',                       //字号
                height: '380',                          //高度
                width: '580',                            //宽度
                start_time: '',                      //开始时间
                end_time: '',                        //结束时间
                period: '10',                          //采集周期
                status: '',                          //监控状态
                contents: '',                        //显示内容
                gather_rule: '',                     //采集规则
                gather_params: '',                   //节点
                params: '',                         //监控参数
                monitor_area: ''                             //日历地区
            },             //图表单元
            rules2: {
                font_size: [
                    {required: true, message: '请选择字号', trigger: 'change'}
                ],
                height: [
                    {required: true, message: '请输入高度', trigger: 'blur'}
                ],
                width: [
                    {required: true, message: '请输入宽度', trigger: 'blur'}
                ],
                contents: [
                    {required: true, message: '请输入内容', trigger: 'blur'}
                ],
                gather_params: [
                    {required: true, message: '请选择图片类型', trigger: 'change'}
                ],
                period: [
                    {required: true, message: '请输入采集周期(以秒为单位)', trigger: 'blur'}
                ],
            },                              //校验规则
            job: {                                   //作业单元
                monitor_name: '',                    //单元名称
                monitor_type: '',                    //单元类型
                font_size: '20',                       //字号
                height: '120',                          //高度
                width: '200',                            //宽度
                start_time: '',                      //开始时间
                end_time: '',                        //结束时间
                period: '10',                          //采集周期
                status: '',                          //监控状态
                contents: '',                        //显示内容
                gather_rule: '',                     //NODE_KEY
                gather_params: '',                   //作业模板
                params: '',                         //执行服务器
                monitor_area: ''                             //日历地区
            },                //作业单元
            rules3: {
                font_size: [
                    {required: true, message: '请选择字号', trigger: 'change'}
                ],
                height: [
                    {required: true, message: '请输入高度', trigger: 'blur'}
                ],
                width: [
                    {required: true, message: '请输入宽度', trigger: 'blur'}
                ],
                contents: [
                    {required: true, message: '请输入内容', trigger: 'blur'}
                ],
                gather_params: [
                    {required: true, message: '请选择作业模板', trigger: 'change'}
                ],
                period: [
                    {required: true, message: '请输入采集周期(以秒为单位)', trigger: 'blur'}
                ],
            },                              //校验规则
            flow: {                                     //流程单元
                monitor_name: '',                    //单元名称
                monitor_type: '',                    //单元类型
                font_size: '20',                       //字号
                height: '20',                          //高度
                width: '0',                            //宽度
                start_time: '',                      //开始时间
                end_time: '',                        //结束时间
                period: '10',                          //采集周期
                params: '',                         //监控参数
                status: '',                          //监控状态
                contents: '',                        //显示内容
                gather_rule: '',                     //采集规则
                gather_params: '',                   //流程模板
                node_name: '',
                monitor_area: ''                             //日历地区
            },              //流程单元
            rules4: {
                font_size: [
                    {required: true, message: '请选择字号', trigger: 'change'}
                ],
                height: [
                    {required: true, message: '请输入高度', trigger: 'blur'}
                ],
                width: [
                    {required: true, message: '请输入宽度', trigger: 'blur'}
                ],
                gather_rule: [
                    {required: true, message: '请选择流程模板', trigger: 'change'}
                ],
                period: [
                    {required: true, message: '请输入采集周期(以秒为单位)', trigger: 'blur'}
                ]
            },//基本监控项（修改后）的校验规则
            basicMonitorRules: {
                font_size: [
                    {required: true, message: '请选择字号', trigger: 'change'}
                ],
                height: [
                    {required: true, message: '请填写高度', trigger: 'blur'},
                    {validator: height_range_check, trigger: 'blur'}
                ],
                width: [
                    {required: true, message: '请填写宽度', trigger: 'blur'},
                    {validator: width_range_check, trigger: 'blur'}
                ],
                interface_type: [
                    {required: true, message: '请选择来源类型', trigger: 'change'}
                ],
                measures: [
                    {required: true, message: '请选择来源名称', trigger: 'change'}
                ],
                measures_name: [
                    {required: true, message: '请选择度量值', trigger: 'change'}
                ],
                show_rule_type: [
                    {required: true, message: '请选择展示规则', trigger: 'change'}
                ],
                gather_rule: [
                    {required: true, message: '请填写数据采集规则', trigger: 'change'}
                ],
                start_time: [
                    {required: true, message: '请选择采集开始时间', trigger: 'change'}
                ],
                end_time: [
                    {required: true, message: '请选择采集结束时间', trigger: 'change'}
                ],
                period: [
                    {required: true, message: '请填写采集周期', trigger: 'blur'}
                ],
                dimension_data: {
                    dimension_name: [
                        {required: true, message: '请选择维度名称', trigger: 'change'}
                    ],
                    dimension_value: [
                        {required: true, message: '请填写维度值', trigger: 'blur'}
                    ]
                },
                score: [
                    {required: true, message: '请输入分值', trigger: 'change'}
                ]
            },
            //校验规则
            basic1: {                                //基本单元
                monitor_name: '',                    //单元名称
                monitor_type: '',                    //单元类型
                font_size: '20',                       //字号
                height: '20',                          //高度
                width: '0',                            //宽度
                start_time: '',                      //开始时间
                end_time: '',                        //结束时间
                period: '10',                          //采集周期
                params: '',                         //监控参数
                status: '',                          //监控状态
                contents: '',                        //显示内容
                gather_rule: '',                     //采集规则
                gather_params: 'sql',                   //采集参数
                monitor_area: ''                             //日历地区
            },
            chart1: {                                //图表单元
                monitor_name: '',                    //单元名称
                monitor_type: '',                    //单元类型
                font_size: '20',                       //字号
                height: '380',                          //高度
                width: '580',                            //宽度
                start_time: '',                      //开始时间
                end_time: '',                        //结束时间
                period: '10',                          //采集周期
                status: '',                          //监控状态
                contents: '',                        //显示内容
                gather_rule: '',                     //采集规则
                gather_params: '',                   //节点
                params: '',                          //监控参数
                monitor_area: ''                             //日历地区
            },
            job1: {                                   //作业单元
                monitor_name: '',                    //单元名称
                monitor_type: '',                    //单元类型
                font_size: '20',                       //字号
                height: '20',                          //高度
                width: '0',                            //宽度
                start_time: '',                      //开始时间
                end_time: '',                        //结束时间
                period: '10',                          //采集周期
                status: '',                          //监控状态
                contents: '',                        //显示内容
                gather_rule: '',                     //NODE_KEY
                gather_params: '',                   //作业模板
                params: '',                         //执行服务器
                monitor_area: ''                             //日历地区
            },
            flow7: {                                //流程单元
                monitor_name: '',                    //单元名称
                monitor_type: '',                    //单元类型
                font_size: '20',                       //字号
                height: '20',                          //高度
                width: '0',                            //宽度
                start_time: '',                      //开始时间
                end_time: '',                        //结束时间
                period: '',                          //采集周期
                params: '10',                         //监控参数
                status: '',                          //监控状态
                contents: '',                        //显示内容
                gather_rule: '',                     //采集规则
                gather_params: '',                   //流程模板
                monitor_area: ''                             //日历地区
            },
            myChart: null,
            chart_content: '',
            chartData: '',
            person_count: '',
            measures: '',
            measures_name: '',
            iqube_name: [],
            //度量值列表
            metric_list: [],
            //维度名称列表
            dimension_list: [],
            gather_list: [],
            gather_base_test_data: [],
            /*dimension_data:[{
                dimension_name:'ip',
                dimension_value:'192.168.1.153'
            }],*/


        },
        methods: {
            //获取采集测试的结果，同步调用
            get_gather_test() {
                $.ajax({
                    type: "POST",
                    data: JSON.stringify(vm.base),
                    dataType: "JSON",
                    async: false,
                    url: "${SITE_URL}iqube_interface/gather_base_test/",
                    success: function (data) {
                        if (0 != data.code) {
                            vm.$alert("采集测试未通过，请校正接口调用参数或稍后重试！", "错误");
                            return;
                        }
                        //采集测试的数据缓存到gather_data_test_data变量中
                        console.log(data.results)
                        vm.gather_test_data = data.results;
                    },
                    error: function (error) {
                        vm.$alert("采集测试未通过，请校正接口调用参数或稍后重试！", "错误");
                        return;
                    }
                });
            },
            //基本监控项（修改后）显示内容变更时调用的预览变更方法
            content_modified_change() {
                this.base_monitor_other_fixed_status();
                this.content_change();
            },
            //基本监控项显示方式为其他且显示内容为空时显示的单位
            base_monitor_other_fixed_status() {
                if (vm.base.show_rule_type == 2) {
                    if ('' == vm.base['contents'].replace(/^\s+|\s+$/g, "")) {
                        $('#other_fixed_show').show();
                    } else {
                        $('#other_fixed_show').hide();
                    }
                }
            },
            //基本监控项修改后显示内容重置方法
            base_monitor_show_reset() {
                //base['contents']使用缓存的所有指标值显示内容替换
                this.base['contents'] = this.base_monitor_show_cache;
                //如果显示方式为其他，且显示内容为空，移除为空时显示的当前单位
                this.base_monitor_other_fixed_status();
                //更替显示内容
                this.content_change();
            },
            //基本监控项修改后颜色和其他选项提示信息添加方法
            add_comments() {
                if ('1' == this.base.show_rule_type) {
                    this.color_rules_comments = true;
                    this.other_rules_comments = false;
                } else if ('2' == this.base.show_rule_type) {
                    this.color_rules_comments = false;
                    this.other_rules_comments = true;
                } else {
                    this.color_rules_comments = false;
                    this.other_rules_comments = false;
                }

            },
            //监控项数据处理，用于编辑状态下回显数据
            monitor_edit_data_process(row) {
                //如果监控项类型为基本基本监控单元（修改后）
                if ('five' == vm.monitor_type) {
                    //基本监控项采集类型初始化
                    this.sql_file_interface = row.gather_params;
                    //切换基本监控项的数据来源类型展示不同的内容
                    this.base_gather_source_change(vm.sql_file_interface);
                    if (vm.sql_file_interface == 'interface') {
                        vm.sql_file_interface = 9;
                        if (row.dimension != null) {
                            vm.base['dimension_data'] = JSON.parse(row.dimension);
                        } else {
                            vm.base['dimension_data'] = [];
                        }
                        if (0 == row.source_type) {
                            this.change_source_type('log');
                            this.base['interface_type'] = 'log';
                        } else if (1 == row.source_type) {
                            this.change_source_type('measures');
                            this.base['interface_type'] = 'measures';
                        } else {
                            this.base['interface_type'] = null;
                        }
                        vm.base['measures_name'] = row.measure_name;
                        vm.base['measures'] = row.target_name;
                        //下拉框不识别number类型的数据，需要转化为字符串供下拉框回显
                        vm.base['show_rule_type'] = row.display_type.toString();
                        //展示类型为颜色时显示提示信息
                        if ('1' == vm.base['show_rule_type']) {
                            this.color_rules_comments = true;
                            this.other_rules_comments = false;
                        } else if ('2' == vm.base['show_rule_type']) {
                            this.other_rules_comments = true;
                            this.color_rules_comments = false;
                        }
                        vm.base['monitor_name'] = vm.monitor_name;
                        vm.base['monitor_type'] = vm.monitor_type;
                        vm.base['font_size'] = row.font_size;
                        vm.base['height'] = row.height;
                        vm.base['width'] = row.width;
                        vm.base['start_time'] = row.start_time;
                        vm.base['end_time'] = row.end_time;
                        vm.base['period'] = row.period;
                        vm.base['params'] = row.params;
                        vm.base['status'] = row.status;
                        vm.base['contents'] = row.contents;
                        vm.base['gather_rule'] = row.gather_rule;
                        vm.base['gather_params'] = row.gather_params;
                        vm.base['monitor_area'] = vm.area;
                        vm.base['score'] = row.score;
                    } else {
                        alert('暂未实现！');
                    }
                }
            },
            //数据添加后缓存数据清空操作
            monitor_cache_clean() {
                //基本监控项（修改后）的清空操作
                if ('five' == vm.monitor_type) {
                    this.base['dimension_data'] = [];
                    this.base['measures_name'] = '';
                    this.base['measures'] = '';
                    this.base['interface_type'] = '';
                    this.base['show_rule_type'] = '';
                    //清空数据后默认为基本监控类型（修改后）
                    this.base['monitor_type'] = 5;
                    this.base['font_size'] = '20';
                    this.base['height'] = '480';
                    this.base['width'] = '422';
                    this.base['start_time'] = '';
                    this.base['end_time'] = '';
                    this.base['period'] = '10';
                    this.base['params'] = '';
                    this.base['status'] = '';
                    this.base['contents'] = '';
                    this.base['gather_rule'] = '';
                    //采集参数默认为interface
                    this.base['gather_params'] = 'interface';
                    this.base['monitor_area'] = '';
                }
                //采集测试标志位置空
                vm.gather_data_test_flag = null;
                //采集测试缓存数据清空
                this.gather_test_data = null;
                //采集测试的预览框清空
                $('#base_test_text').html('');
                //提示信息状态标志位置false
                this.color_rules_comments = false;
                this.other_rules_comments = false;
                //如果是基本监控项（修改后）的修改窗口被关闭基本监控项编辑初始化状态重置为true
                if (1 == vm.add_pamas) {
                    this.base_monitor_edit_init = true;
                    this.base_monitor_edit_test_init = true;
                } else if (0 == vm.add_pamas) {
                    this.base_monitor_add_init = true;
                    this.base_monitor_add_test_init = true;
                }
                //缓存的当前所有指标的显示内容清空
                vm.base_monitor_show_cache = '';
            },
            //基本监控项（修改后）的数据来源切换
            base_gather_source_change(source_type) {
                if ('sql' == source_type || '3' == source_type) {
                    //显示数据库表单
                    this.database_show = true;
                    this.file_show = false;
                    this.interface_show = false;
                } else if ('interface' == source_type || '9' == source_type) {
                    //显示关闭文件和数据库的显示，显示接口表单
                    this.database_show = false;
                    this.file_show = false;
                    this.interface_show = true;
                } else if ('file' == source_type || '6' == source_type) {
                    //显示文件表单
                    this.database_show = false;
                    this.file_show = true;
                    this.interface_show = false;
                } else {
                    console.log('基本监控项数据来源类型错误： ' + source_type);
                }
            },
            //将监控项类型的编码转换成中文的名称，前台转换
            format_monitor_type(row, column) {
                if (row.monitor_type === 1) {
                    return "基本监控项"
                } else if (row.monitor_type === 2) {
                    return "图表监控项"
                } else if (row.monitor_type === 3) {
                    return "作业监控项"
                } else if (row.monitor_type === 4) {
                    return "流程监控项"
                } else if (row.monitor_type === 5) {
                    return "基本监控项（一体化平台）"
                }
            },
            //基本监控项的数据处理方法
            base_monitor_data_process() {
                //数据整合与处理
                this.base_monitor_upload_data['jion_id'] = null;
                if ('log' == this.base['interface_type']) {
                    this.base_monitor_upload_data['source_type'] = 0;
                } else if ('measures' == this.base['interface_type']) {
                    this.base_monitor_upload_data['source_type'] = 1;
                } else {
                    this.base_monitor_upload_data['source_type'] = null;
                }
                //base对象被其他功能所使用，因此不能删除其属性用于上传数据，另外定义一个新的变量缓存并上传
                this.base_monitor_upload_data['target_name'] = this.base['measures'];
                this.base_monitor_upload_data['measure_name'] = this.base['measures_name'];
                if (null == this.base['dimension_data'] || 0 === this.base['dimension_data'].length) {
                    this.base_monitor_upload_data['dimension'] = null;
                } else {
                    this.base_monitor_upload_data['dimension'] = JSON.stringify(this.base['dimension_data']);
                }
                this.base_monitor_upload_data['display_type'] = this.base['show_rule_type'];
                this.base_monitor_upload_data['display_rule'] = this.base['gather_rule'];
                this.base_monitor_upload_data['gather_rule'] = this.base['gather_rule'];
                this.base_monitor_upload_data['gather_params'] = this.base['gather_params'];
                this.base_monitor_upload_data['params'] = this.base['params'];
                this.base_monitor_upload_data['width'] = this.base['width'];
                this.base_monitor_upload_data['height'] = this.base['height'];
                this.base_monitor_upload_data['font_size'] = this.base['font_size'];
                this.base_monitor_upload_data['period'] = this.base['period'];
                this.base_monitor_upload_data['start_time'] = this.base['start_time'];
                this.base_monitor_upload_data['end_time'] = this.base['end_time'];
                this.base_monitor_upload_data['contents'] = this.base['contents'];
                this.base_monitor_upload_data['score'] = this.base['score'];
                this.result_data = this.base_monitor_upload_data;
                //由于调用采集测试接口需要以下参数,因此在此统一删除数据库表不存在的字段,避免监控项添加时报错
                /*delete this.base['dimension_data'];
                delete this.base['interface_type'];
                delete this.base['measures'];
                delete this.base['measures_name'];
                delete this.base['show_rule_type'];*/
            },
            //采集测试的数据保存方法
            gather_data_test_save(item_id, type) {
                axios({
                    method: 'post',
                    url: '${SITE_URL}gather_data/gather_data_save',
                    data: {
                        'measures': this.gather_test_data,
                        'item_id': item_id,
                        'type': type
                    }
                }).then((res) => {
                    console.log('采集测试数据保存成功');
                }).catch((error) => {
                    vm.$alert("采集测试数据保存失败！", "错误");
                });
            },
            //监控项数据编辑后的保存方法
            monitor_data_save(unit_id, flow) {
                if (vm.monitor_name == '') {
                    vm.message = '监控项名称不能为空!';
                    this.$alert(vm.message, "错误");
                    vm.unit_id = -1;
                    return false;
                }
                //unit_id大于0的情况为编辑后的数据上传
                if (unit_id > 0) {
                    axios({
                        method: 'post',
                        url: '${SITE_URL}monitor_item/edit/',
                        data: {
                            'flow': flow,
                            data: vm.result_data,
                            monitor_type: vm.monitor_type,
                            monitor_name: vm.monitor_name,
                            unit_id: vm.unit_id,
                            monitor_area: vm.area
                        }
                    }).then((res) => {
                        if (res['data']['code'] == 1) {
                            this.$alert("保存失败!", "错误");
                            vm.centerDialogVisible = true;
                        } else {
                            //保存采集测试的数据到服务器
                            vm.gather_data_test_save(vm.unit_id, 'edit');
                            this.$alert(vm.message, "提示");
                            vm.centerDialogVisible = false;
                        }
                        vm.show();

                    }).catch((error) => {
                        this.$alert("修改保存出错！", "错误")
                    });
                }
                //unit_id等于0的情况下为添加后的数据上传
                else if (unit_id == 0) {
                    axios({
                        method: 'post',
                        url: '${SITE_URL}monitor_item/add/',
                        data: {
                            'flow': flow,
                            data: vm.result_data,
                            monitor_type: vm.monitor_type,
                            monitor_name: vm.monitor_name,
                            monitor_area: vm.area
                        }
                    }).then((res) => {
                        if (res['data']['code'] == 1) {
                            this.$alert("新增保存失败!", "错误");
                            vm.centerDialogVisible = true;
                        } else {
                            //保存采集测试的数据到服务器
                            vm.gather_data_test_save(res.data['item_id'], 'add');
                        }
                        vm.show()

                    }).catch((error) => {
                        this.$alert('新增保存失败!', "错误");
                    });
                } else {
                    vm.centerDialogVisible = true;
                    if (vm.add_pamas == 0) {
                        vm.unit_id = 0
                    } else {
                        vm.unit_id = vm.unit_id1
                    }
                }
            },
            add_dimension() {
                vm.$set(vm.base.dimension_data, vm.base.dimension_data.length, {
                    dimension_name: '',
                    dimension_value: ''
                });
            },
            delete_dimension(index) {
                vm.base.dimension_data.splice(index, 1);
            },
            basic_size() {
                $("#text2").find("*").css("font-size", this.basic.font_size)
            },
            //基本监控项修改后的字体大小变更
            base_size() {
                collection_base_size(vm, '#base_test_text')
            },
            basic_height() {
                $('#text2').css('height', this.basic.height)
            },
            basic_width() {
                $("#text2").css("width", this.basic.width)
            },
            get_header_data() {
                axios.get('${SITE_URL}market_day/get_header/').then(function (res) {
                })
            },
            get_all_area() {
                axios({
                    method: 'get',
                    url: '${SITE_URL}market_day/get_all_area',
                }).then(function (res) {
                    res = res.data.message
                    console.log(res)
                    vm.areas = []
                    for (var i = 0; i < res.length; i++) {
                        var label = res[i].country + "(" + res[i].timezone + ")"
                        temp = {
                            'area': label,
                            'value': res[i].id
                        }
                        vm.areas.push(temp)
                    }
                })
            },
            sycontent() {
                //当显示内容为空的情况下
                if ("@" == split_char && '' == vm.basic.contents.replace(/^\s+|\s+$/g, "")) {
                    $('#text2').show();
                }
                var content = vm.basic.contents
                var content_str = content.substring(0, content.lastIndexOf('@')); //去@符号
                var content_obj = '{' + content_str.replace(/@\n/g, ',') + '}';      //加{}
                var content_json = JSON.parse(content_obj);
                var html_obj = "#text2"
                $(html_obj).find('.display').hide();       //隐藏预览区域的dom
                for (x in content_json) {                             //遍历json
                    $(html_obj).find('[type=' + x + ']').show();   //显示内容存在的key会在预览区域显示
                    let len = $(html_obj + " p").length;
                    for (let i = 0; i < len; i++) {
                        let dom_type = $(html_obj + " p").eq(i).attr('type');//获取dom的type
                        let value1 = $(html_obj + " p").eq(i).text().split(':')[0];//获取dom的text ：前面的内容
                        if (x == dom_type) {//显示内容的key等于dom的type
                            let text = $(html_obj + " p").eq(i).text();
                            $(html_obj + " p").eq(i).html(text.replace(value1, content_json[x]));//将dom的text ：前面的内容替换成显示内容的value
                            var content = $(html_obj + " p").eq(i).html();
                        }
                    }
                }
            },
            basic_test() {
                let params = '';
                if (vm.sql_file_interface == 3) {
                    params = vm.server_url
                }
                if (vm.sql_file_interface == 6 || vm.sql_file_interface == 9) {
                    params = vm.server_url + '#' + vm.file_param
                }
                axios({
                    method: 'post',
                    url: '${SITE_URL}monitor_item/basic_test/',
                    data: {
                        id: vm.unit_id,
                        params: params,
                        gather_rule: vm.basic.gather_rule,
                        gather_params: vm.basic.gather_params,
                        score:vm.basic.score
                    },
                }).then(function (res) {
                    let tempcontents2 = vm.basic.contents
                    $("#text2").html("")
                    $("#text2").append("<div class=\"newline\" style=\"font-size:" + vm.basic.font_size + "px;\">" + tempcontents2 + "</div>")
                    if (vm.basic.contents.indexOf("#") > -1 && vm.basic.contents.indexOf('@') == -1) {
                        var temp1 = tempcontents2.split("#");
                        var temp2 = [];
                        var temp3 = [];
                        var temp4 = [];
                        for (var i = 1; i < temp1.length; i = i + 2) {
                            temp2.push(temp1[i]);
                        }
                        for (var i = 0; i < temp2.length; i++) {
                            temp3.push(temp2[i].split("="))
                        }
                        for (var i = 0; i < temp3.length; i++) {
                            temp4.push(temp3[i][0])
                        }
                        $("#text2").html("")
                        for (var i = 0, j = 0; i < temp1.length; i = i + 2, j++) {
                            if (j < temp4.length) {
                                $("#text2").append("<div class=\"newline\" style=\"font-size:" + vm.basic.font_size + "px;\">" + temp1[i] + res.data.message[0][temp4[j]] + "</div>");
                            } else {
                                $("#text2").append("<div class=\"newline\" style=\"font-size:" + vm.basic.font_size + "px;\">" + temp1[i] + "</div>");
                            }
                        }
                    }
                    if (vm.basic.contents.indexOf('@') > -1 && vm.basic.contents.indexOf("#") == -1) {
                        var icon1 = tempcontents2.split("@");
                        var icon2 = [];
                        var icon3 = [];
                        var icon4 = '';
                        if (res.data.message[0]['DB_CONNECTION']) {
                            icon4 = res.data.message[0]['DB_CONNECTION'];
                        }
                        if (res.data.message[0]['URL_CONNECTION']) {
                            icon4 = res.data.message[0]['URL_CONNECTION'];
                        }
                        if (res.data.message[0]['FILE_EXIST']) {
                            icon4 = res.data.message[0]['FILE_EXIST'];
                        }
                        $("#text2").html("")
                        $("#text2").append("<div class = \"asd\" style=\"font-size:" + vm.basic.font_size + "px;\">" + icon1[0] + "</div>");
                        if (icon4 == 1) {
                            $("#text2").append("<div class=\"circle1\"></div>");
                        }
                        if (icon4 == 2) {
                            $("#text2").append("<div class=\"circle2\"></div>");
                        }
                        if (icon4 == 0) {
                            $("#text2").append("<div class=\"circle3\"></div>");
                        }
                        if (icon4 == -1 || icon4 == -2) {
                            $("#text2").append("<div class=\"circle4\"></div>");
                        }
                    }
                    if (vm.basic.contents.indexOf("#") > -1 && vm.basic.contents.indexOf('@') > -1) {
                        var temp1 = tempcontents2.split("#");
                        var temp2 = [];
                        var temp3 = [];
                        var temp4 = [];
                        for (var i = 1; i < temp1.length; i = i + 2) {
                            temp2.push(temp1[i]);
                        }
                        for (var i = 0; i < temp2.length; i++) {
                            temp3.push(temp2[i].split("="))
                        }
                        for (var i = 0; i < temp3.length; i++) {
                            temp4.push(temp3[i][0])
                        }
                        var icon1 = [];
                        var icon2 = [];
                        var icon3 = [];
                        var icon4 = '';
                        var flag2 = 0;
                        for (var i = 0; i < temp1.length; i = i + 2) {
                            if (temp1[i].indexOf("@") > -1) {
                                icon1 = temp1[i].split("@")
                                flag2 = i
                                for (var k = 0; k < icon1.length; k++) {
                                    icon2.push(icon1[k])
                                }
                            }
                        }
                        icon3 = icon2[1].split("=")
                        if (res.data.message[0]['DB_CONNECTION']) {
                            icon4 = res.data.message[0]['DB_CONNECTION'];
                        }
                        if (res.data.message[0]['URL_CONNECTION']) {
                            icon4 = res.data.message[0]['URL_CONNECTION'];
                        }
                        if (res.data.message[0]['FILE_EXIST']) {
                            icon4 = res.data.message[0]['FILE_EXIST'];
                        }
                        $("#text2").html("")
                        for (var i = 0, j = 0; i < temp1.length; i = i + 2, j++) {
                            if (i == flag2) {
                                $("#text2").append("<div class = \"asd\" style=\"font-size:" + vm.basic.font_size + "px;\">" + icon1[0] + "</div>");
                                if (icon4 == 1) {
                                    $("#text2").append("<div class=\"circle1\"></div>");
                                }
                                if (icon4 == 2) {
                                    $("#text2").append("<div class=\"circle2\"></div>");
                                }
                                if (icon4 == 0) {
                                    $("#text2").append("<div class=\"circle3\"></div>");
                                }
                                if (icon4 == -1 || icon4 == -1) {
                                    $("#text2").append("<div class=\"circle4\"></div>");
                                }
                            } else {
                                $("#text2").append("<div class=\"newline\" style=\"font-size:" + vm.basic.font_size + "px;\">" + temp1[i] + res.data.message[0][temp4[j]] + "</div>");
                            }
                        }
                    }
                });
            },
            // 保存
            pefFrom() {
                /*
                var basic = $('#pane-first').attr('style');
                var chart = $('#pane-second').attr('style');
                var job = $('#pane-third').attr('style');
                var flow = $('#pane-fourth').attr('style');
                var base = $('#pane-five').attr('style');
                if (basic == undefined || basic == "") {
                    vm.submitForm('basic')
                } else if (chart == undefined || chart == "") {
                    vm.submitForm('chart')
                } else if (job == undefined || job == "") {
                    vm.submitForm('job')
                } else if (flow == undefined || flow == "") {
                    vm.submitForm('flow')
                } else if (base == undefined || base == "") {
                    vm.submitForm('base')
                }*/
                //目前只有两种监控项
                if("first" == vm.monitor_type){
                    vm.submitForm('basic')
                }else if("five" == vm.monitor_type){
                    vm.submitForm('base')
                }
            },
            current_change1(value) {
                vm.page = value;
                vm.show()

            },
            //保存按钮
            submitForm(formName) {
                if(vm.isShow == false){
                    this.$refs[formName].validate((valid) => {
                        if (valid) {
                            vm.edit1()
                        } else {
                            console.log('error submit!!');
                            return false;
                        }
                    });
                 }
            },
            delete_unit(row) {
                this.$confirm('此操作将永久删除该监控项, 是否继续?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning',
                    center: true
                }).then(() => {
                    this.$message({
                            type: 'success',
                            message: '删除成功!',
                        },
                        axios({
                            method: 'post',
                            url: '${SITE_URL}monitor_item/delete/',
                            data: {
                                unit_id: row.id,
                                monitor_name: row.monitor_name,
                                monitor_type: row.monitor_type,
                            }
                        }).then((res) => {
                            vm.page = 1;
                            vm.show()

                        }),);
                }).catch(() => {
                    this.$message({
                        type: 'info',
                        message: '已取消删除'
                    });
                });
            },
            show() {
                axios({
                    method: 'post',
                    url: '${SITE_URL}monitor_item/show/',
                    data: {
                        page: vm.page,
                        limit: 10
                    },
                }).then(function (res) {
                    vm.sites = res.data.results.res_list;
                    vm.page_count = res.data.results.res_list[0].page_count;
                    //vm.job2 = res.data.results.job;
                    //vm.flow2 = res.data.results.flow;
                })
                    vm.showAPI();
            },
            showAPI() {
                 setTimeout(function(){
                       axios({
                            method: 'post',
                            url: '${SITE_URL}monitor_item/showAPI/',
                            data: {
                                page: vm.page,
                                limit: 10
                            },
                        }).then(function (res) {
                            vm.job2 = res.data.results.job;
                            vm.flow2 = res.data.results.flow;
                        })
                        },1000);
            },
            select1() {
                vm.centerDialogVisible = false;
                vm.page = 1;
                if (vm.contents == "") {
                    vm.show()

                } else {
                    axios({
                        method: 'post',
                        url: '${SITE_URL}monitor_item/select/',
                        data: {
                            data: this.contents,
                            page: vm.page,
                            limit: 10
                        }
                    }).then((res) => {
                        if (res.data.results.length == 0) {
                            vm.sites = [];
                            vm.page_count = 1
                        } else {
                            vm.sites = res.data.results;
                            vm.page_count = res.data.results[0].page_count;
                        }
                    }).catch(function (e) {
                        vm.$message.error('获取数据失败！');
                    });
                }
            },
            //编辑单元
            edit_unit(row) {
                this.get_db_connections();
                vm.add_pamas = 1;
                vm.centerDialogVisible = true;
                //默认编辑下显示基本监控项取消
                //vm.disabled2 = false;
                vm.disabled2 = true;
                //-----------------------------
                //vm.disabled3 = true;
                //vm.disabled4 = true;
                //vm.disabled5 = true;
                //默认编辑下显示基本监控项（修改）
                vm.disabled6 = false;
                //-----------------------------
                vm.unit_id = row.id;
                vm.monitor_name = row.monitor_name;
                //原始基本监控项
                if (row.monitor_type === 1) {
                    vm.monitor_type = 'first';
                    vm.basic.font_size = row.font_size;
                    vm.basic.height = row.height;
                    vm.basic.width = row.width;
                    vm.basic.start_time = row.start_time;
                    vm.basic.end_time = row.end_time;
                    vm.basic.period = row.period;
                    vm.sql_file_interface = row.gather_params;
                    vm.file_param = row.file_param;
                    vm.basic.start_time = row.start_time;
                    vm.basic.end_time = row.end_time;
                    vm.basic.gather_rule = row.gather_rule;
                    vm.basic.contents = row.contents;
                    vm.basic.status = row.status;
                    vm.basic.score = row.score;
                    vm.basic.measure_name = row.measure_name
                    vm.basic.display_type = row.display_type
                    vm.basic.display_rule = row.display_rule
                    vm.area = row.monitor_area;
                    if (vm.sql_file_interface == 'sql') {
                        vm.sql_file_interface = 3;
                        axios({
                            method: 'post',
                            url: '${SITE_URL}db_connection/get_conname/',
                            data: row.params,
                        }).then((res) => {
                            //vm.server_url = res['data']['results']['connname'];
                            vm.sql_id = res['data']['results']['id'];
                            vm.server_url = vm.sql_id;
                            vm.basic_size();
                            vm.basic_height();
                            vm.basic_width();
                            vm.sycontent();
                            vm.basic_test()
                        }).catch(function (e) {
                            vm.$message.error('获取数据库失败！');
                        });
                        vm.sql1 = 'block';
                        vm.file1 = 'none';
                        vm.interface1 = 'none';
                        vm.basic.gather_params = 'sql'
                    }
                    if (vm.sql_file_interface == 'file') {
                        vm.sql_file_interface = 6;
                        arr = row.params.split("#");
                        vm.server_url = arr[0];
                        vm.file_param = arr[1];
                        vm.typeid = '2';
                        vm.sql1 = 'none';
                        vm.file1 = 'block';
                        vm.interface1 = 'none';
                        vm.basic.gather_params = 'file';
                        vm.basic_size();
                        vm.basic_height();
                        vm.basic_width();
                        vm.sycontent();
                        vm.basic_test()
                    }
                    if (vm.sql_file_interface == 'interface') {
                        vm.sql_file_interface = 9;
                        arr = row.params.split("#");
                        vm.server_url = arr[0];
                        vm.file_param = arr[1];
                        vm.typeid = '3';
                        vm.sql1 = 'none';
                        vm.file1 = 'none';
                        vm.interface1 = 'block';
                        vm.basic.gather_params = 'interface';
                        vm.basic_size();
                        vm.basic_height();
                        vm.basic_width();
                        vm.sycontent();
                        vm.basic_test()
                    }
                }
                //图表监控项
                /*
                if (row.monitor_type === 2) {
                    vm.disabled3 = false;
                    console.log(row)
                    vm.monitor_type = 'second';
                    vm.chart.font_size = row.font_size;
                    vm.chart.height = row.height;
                    vm.chart.width = row.width;
                    vm.chart.start_time = row.start_time;
                    vm.chart.end_time = row.end_time;
                    vm.chart.period = row.period;
                    vm.chart.gather_params = row.gather_params;
                    vm.chart.contents = row.contents;
                    vm.chart.start_time = row.start_time;
                    vm.chart.end_time = row.end_time;
                    vm.chart.gather_rule = row.gather_rule;
                    vm.chart.status = row.status;
                    vm.area = row.monitor_area;
                    axios({
                        method: 'post',
                        url: '${SITE_URL}db_connection/get_conname/',
                        data: row.params,
                    }).then((res) => {
                        vm.chart.params = res['data']['results']['connname'];
                        vm.show_content();
                    }).catch(function (e) {
                        vm.$message.error('获取数据库失败！');
                    });
                }*/
                //作业监控项
                /*
                if (row.monitor_type === 3) {
                    vm.disabled4 = false;
                    vm.monitor_type = 'third';
                    vm.job.font_size = row.font_size;
                    vm.job.height = row.height;
                    vm.job.width = row.width;
                    vm.change_job_fontSize();
                    vm.change_job_height();
                    vm.change_job_width();
                    vm.job.start_time = row.start_time;
                    vm.job.end_time = row.end_time;
                    vm.job.period = row.period;
                    vm.job.contents = row.contents;
                    vm.job.gather_rule = row.gather_rule;
                    vm.job.gather_params = row.gather_params;
                    vm.job.params = row.params;
                    vm.job.status = row.status;
                    vm.area = row.monitor_area;
                }*/
                //流程监控项
                /*
                if (row.monitor_type === 4) {
                    vm.disabled5 = false;
                    vm.monitor_type = 'fourth';
                    console.log(row)
                    vm.flow.font_size = row.font_size;
                    vm.flow.height = row.height;
                    vm.flow.width = row.width;
                    vm.flow.start_time = row.start_time;
                    vm.flow.end_time = row.end_time;
                    vm.flow.period = row.period;
                    vm.flow.status = row.status;
                    vm.flow.jion_id = row.jion_id;
                    vm.flow.period = row.period;
                    vm.flow.node_name = row.gather_params;
                    vm.flow.gather_rule = {
                        'name': row.gather_rule,
                        'id': row.jion_id
                    };
                    vm.area = row.monitor_area;
                    var id1 = row.jion_id
                    var id = [{
                        'id': id1
                    }]
                    vm.flow_change(id)
                }*/
                //基本监控项（一体化）
                if (row.monitor_type === 5) {
                    vm.disabled6 = false;
                    //监控项类型设置
                    this.monitor_type = 'five';
                    //处理监控项的数据用于修改时的数据回显
                    this.monitor_edit_data_process(row);
                    // 执行采集测试
                    this.base_cell_test();
                }
            },
            //保存数据处理
            edit1() {
                vm.message = '保存成功!';
                var node_time = {};
                var flow = {};
                if (vm.monitor_type == 'first') {
                    vm.result_data = vm.basic;
                    if (vm.file_param == undefined) {
                        vm.basic.params = vm.server_url
                    } else {
                        vm.basic.params = vm.server_url + '#' + vm.file_param
                    }
                    vm.basic.monitor_name = vm.monitor_name;
                    vm.basic.monitor_type = vm.monitor_type;
                    if (vm.server_url == '') {
                        vm.unit_id = -1;
                        vm.message = '请选择数据库或者填写服务器和url!'
                    }
                    if (vm.basic.gather_rule == '') {
                        vm.unit_id = -1;
                        vm.message = '请输入数据采集规则!'
                    }
                    if (vm.basic.start_time == '') {
                        vm.unit_id = -1;
                        vm.message = '请选择开始时间!'
                    }
                    if (vm.basic.end_time == '') {
                        vm.unit_id = -1;
                        vm.message = '请选择结束时间!'
                    }
                    //上传数据至服务器保存
                    vm.monitor_data_save(vm.unit_id, flow);
                } else if (vm.monitor_type == 'second') {
                    vm.result_data = vm.chart;
                    vm.chart.monitor_name = vm.monitor_name;
                    vm.chart.monitor_type = vm.monitor_type;
                    if (vm.chart.params == '') {
                        vm.unit_id = -1;
                        vm.message = '请选择数据库!'
                    }
                    if (vm.chart.gather_rule == '') {
                        vm.unit_id = -1;
                        vm.message = '请输入采集规则!'
                    }
                    if (vm.chart.start_time == '') {
                        vm.unit_id = -1;
                        vm.message = '请选择开始时间!'
                    }
                    if (vm.chart.end_time == '') {
                        vm.unit_id = -1;
                        vm.message = '请选择结束时间!'
                    }
                    //上传数据至服务器保存
                    vm.monitor_data_save(vm.unit_id, flow);
                } else if (vm.monitor_type == 'third') {
                    vm.result_data = vm.job;
                    vm.job.monitor_name = vm.monitor_name;
                    vm.job.monitor_type = vm.monitor_type;
                    if (vm.job.gather_rule == '') {
                        vm.unit_id = -1;
                        vm.message = '请选择作业模板!'
                    }
                    var reg = /^(?:(?:2[0-4][0-9]\.)|(?:25[0-5]\.)|(?:1[0-9][0-9]\.)|(?:[1-9][0-9]\.)|(?:[0-9]\.)){3}(?:(?:2[0-4][0-9])|(?:25[0-5])|(?:1[0-9][0-9])|(?:[1-9][0-9])|(?:[0-9]))$/;
                    var re = new RegExp(reg);
                    if (vm.job.params == null || vm.job.params == '') {
                        vm.unit_id = -1;
                        vm.message = "IP不可为空!";
                    }
                    if (!re.test(vm.job.params)) {
                        vm.unit_id = -1;
                        vm.message = "请填写有效的IP地址!";
                    }
                    if (vm.job.start_time == '') {
                        vm.unit_id = -1;
                        vm.message = '请选择开始时间!'
                    }
                    if (vm.job.end_time == '') {
                        vm.unit_id = -1;
                        vm.message = '请选择结束时间!'
                    }
                    //上传数据至服务器保存
                    vm.monitor_data_save(vm.unit_id, flow);
                } else if (vm.monitor_type == 'fourth') {
                    vm.result_data = vm.flow;
                    vm.flow.monitor_name = vm.monitor_name;
                    vm.flow.monitor_type = vm.monitor_type;
                    if (vm.flow.gather_rule == '') {
                        vm.unit_id = -1;
                        vm.message = '请选择流程模板!'
                    }
                    var node_times = [];
                    for (var i = 4; i <= vm.location.length - 1; i++) {
                        node_time.node_id = vm.location[i].id ,
                            node_time.starttime = $('#' + vm.location[i].id + '').find('.start_time').text(),
                            node_time.endtime = $('#' + vm.location[i].id + '').find('.end_time').text()
                        node_time.node_name = $('#' + vm.location[i].id + '').find('.node-title').text()
                        if (node_time.starttime == "") {
                            vm.unit_id = -1;
                            vm.message = '请配置每个节点的开始时间';
                        } else if (node_time.endtime == "") {
                            vm.unit_id = -1;
                            vm.message = '请配置每个节点的结束时间';
                        }
                    }
                    node_times.push(node_time);
                    flow.node_times = node_times;
                    flow.monitor_name = vm.monitor_name;
                    flow.monitor_type = vm.monitor_type;
                    console.log(vm.flow.gather_rule);
                    flow.jion_id = vm.flow.gather_rule[0].id;
                    flow.font_size = vm.flow.font_size;
                    flow.height = vm.flow.height;
                    flow.width = vm.flow.width;
                    flow.period = vm.flow.period;
                    flow.constants = vm.constants;
                    //上传数据至服务器保存
                    vm.monitor_data_save(vm.unit_id, flow);
                    //修改后的基本监控项的数据上传处理
                } else if (vm.monitor_type == 'five') {
                    //判断是否已经进行采集测试
                    if (null != this.gather_data_test_flag && false == this.gather_data_test_flag) {
                        this.$alert("采集测试未通过，请校正接口调用参数或稍后重试！", "错误");
                        vm.gather_data_test_flag = null;
                    } else if (null == this.gather_data_test_flag) {
                        //获取采集测试数据，调用同步服务
                        vm.get_gather_test();
                        //基本监控项的数据处理
                        vm.base_monitor_data_process();
                        //上传监控项数据至服务器保存
                        vm.monitor_data_save(vm.unit_id, flow);
                    } else {
                        //基本监控项的数据处理
                        vm.base_monitor_data_process();
                        //上传监控项数据至服务器保存
                        vm.monitor_data_save(vm.unit_id, flow);
                    }
                }
            },
            flow_change(value) {
                vm.node_name(value)
                vm.location = ''
                vm.line = ''
                axios({
                    method: 'post',
                    url: '${SITE_URL}monitor_item/flow_change/',
                    data: {
                        template_id: value
                    }
                }).then(function (res) {
                    {
                        vm.template_list.id = res.data.template_id[0].id
                        vm.template_list.name = res.data.template_id[0].name
                        vm.constants = res.data.constants
                        var aa = "  <div id=\"flow1\" class=\"clearfix workflow-box\" style=\"width:1000px;position: relative;\">\n" +
                            "\n" +
                            "                                        <div class=\"workflow-canvas\" style=\"margin-left: 0px;padding-left: 0px\">\n" +
                            "                                            <!-- 画布模板 start -->\n" +
                            "                                            <div class=\"jtk-content\">\n" +
                            "                                                <div class=\"jtk-demo-canvas canvas-wide jtk-surface jtk-surface-nopan\"\n" +
                            "                                                     id=\"canvas\" style=\"height:500px\">\n" +
                            "                                                    <!-- 流程 -->\n" +
                            "                                                </div>\n" +
                            "                                            </div>\n" +
                            "                                            <!-- 画布模板 end -->\n" +
                            "\n" +
                            "                                        </div>\n" +
                            "\n" +
                            "                                    <!-- template 模板-->\n" +
                            "                                        <div class=\"jtk-delete jtk-none \">删除节点</div>\n" +
                            "                                        <div id=\"template\" class=\"jtk-none\">\n" +
                            "                                            <div class=\"jtk-window jtk-node workfolw-node start-node\" id=\"{charts}\" data-type=\"EmptyEndEvent\">\n" +
                            "                                               <div class=\"node-wrapper\">\n" +
                            "                                                    <img src=\"${STATIC_URL}img/canvas/endpoint.png\" style=\"top: 5px;left: 20px;position: absolute;\">\n" +
                            "                                                </div>\n" +
                            "                                            </div>\n" +
                            "                                             <div class=\"jtk-window jtk-node workfolw-node start-node\" id=\"{charts}\" data-type=\"EmptyStartEvent\">\n" +
                            "                                                <div class=\"node-wrapper\">\n" +
                            "                                                    <img src=\"${STATIC_URL}img/canvas/Start.png\" style=\"top: 5px;left: 20px;position: absolute;\">\n" +
                            "                                                </div>\n" +
                            "                                            </div>\n" +
                            "                                            <div class=\"jtk-window jtk-node workfolw-node database-node\" id=\"{charts}\" data-type=\"ServiceActivity\">\n" +
                            "                                                <div class=\"node-wrapper\">\n" +
                            "                                                    <div class=\"node-content\" style=\"position: relative\">\n" +
                            "                                                        <div class=\"start_time\"\n" +
                            "                                                             style=\"position: absolute;width: 70px;height: 20px;top: -26px;left: 0px;\"></div>\n" +
                            "                                                        <div class=\"end_time\"\n" +
                            "                                                             style=\"position: absolute;width: 70px;height: 20px;top: -26px;right: 0px;\"></div>\n" +
                            "                                                        <p class=\"node-title\" style=\" overflow: hidden;text-overflow:ellipsis;white-space: nowrap;\"></p>\n" +
                            "                                                    </div>\n" +
                            "                                                    <div class=\"node-icon\" style=\"top: 26px;width: 100%;height: 100%;\">\n" +
                            "                                                        <span class=\"title\" style=\"top: -14px;height: 100%;position: relative;color: #F4FFF9;\"></span>\n" +
                            "                                                    </div>\n" +
                            "                                                </div>\n" +
                            "                                            </div>\n" +
                            "                                           <div class=\"jtk-window jtk-node workfolw-node start-node\" id=\"{charts}\" data-type=\"ConvergeGateway\">\n" +
                            "                                                 <div class=\"node-wrapper\">\n" +
                            "                                                    <img src=\"${STATIC_URL}img/canvas/convergegateway.png\">\n" +
                            "                                                </div>\n" +
                            "                                            </div>\n" +
                            "                                            <div class=\"jtk-window jtk-node workfolw-node start-node\" id=\"{charts}\" data-type=\"ParallelGateway\">\n" +
                            "                                                <div class=\"node-wrapper\">\n" +
                            "                                                    <img src=\"${STATIC_URL}img/canvas/ParallelGateway.png\">\n" +
                            "                                                </div>\n" +
                            "                                            </div>\n" +
                            "                                            <div class=\"jtk-window jtk-node workfolw-node cog-node\" id=\"{charts}\"\n" +
                            "                                                 data-type=\"dataCog\">\n" +
                            "                                                <div class=\"node-wrapper\">\n" +
                            "                                                    <div class=\"node-content\">\n" +
                            "                                                        <p class=\"node-title\"></p>\n" +
                            "                                                    </div>\n" +
                            "                                                    <div class=\"node-icon\">\n" +
                            "                                                        <i class=\"bk-icon icon-cog\"></i>\n" +
                            "                                                    </div>\n" +
                            "                                                </div>\n" +
                            "                                            </div>\n" +
                            "\n" +
                            "                                            <div class=\"jtk-window jtk-node workfolw-node filter-node\" id=\"{charts}\"\n" +
                            "                                                 data-type=\"dataFilter\">\n" +
                            "                                                <div class=\"node-wrapper\">\n" +
                            "                                                    <div class=\"node-content\">\n" +
                            "                                                        <p class=\"node-title\"></p>\n" +
                            "                                                    </div>\n" +
                            "                                                    <div class=\"node-icon\">\n" +
                            "                                                        <i class=\"bk-icon icon-circle\"></i>\n" +
                            "                                                    </div>\n" +
                            "                                                </div>\n" +
                            "                                            </div>\n" +
                            "                                        </div>\n" +
                            "                                    </div>"
                        $('#flow_canvas').html(aa)
                        vm.location = res.data.activities
                        vm.line = res.data.flows
                        //显示流程单元中的预览图
                        $('#flow1').dataflow({
                            el: '.tool', //流程拖动源
                            canvas: '#canvas', //画布
                            arrowWidth: 8,
                            arrowHeight: 10,
                            template: '#template',
                            data:
                                {
                                    "line": vm.line, "location": vm.location
                                }
                        });
                        let old_html = $('#canvas').html()
                        $('#canvas').html('<div style="transform: scale(0.65)">' + old_html + '</div>')
                    }
                }).catch(function (e) {
                    vm.$message.error('获取数据失败！');
                });
            },
            node_name(value) {
                axios({
                    method: 'post',
                    url: '${SITE_URL}monitor_item/node_name/',
                    data: {
                        'id': value
                    }
                }).then(function (res) {
                    vm.activities_node_name = res.data.activities
                }).catch(function (e) {
                    vm.$message.error('获取数据失败！');
                });
            },
            Rendering_start_time() {
                $('p:contains(' + vm.flow.node_name + ')').parent().find('.start_time').text(vm.activities_node_time.start_time)
            },
            Rendering_end_time() {
                $('p:contains(' + vm.flow.node_name + ')').parent().find('.end_time').text(vm.activities_node_time.end_time)
            },
            canvas_new() {
                if (vm.liucheng == 'block') {
                    var node_id = ''
                    var start_time = ''
                    var end_time = ''
                    var node_times = []
                    for (var i = 2; i <= vm.location.length - 1; i++) {
                        var node_time = {}
                        node_time.node_id = vm.location[i].id ,
                            node_time.starttime = $('#' + vm.location[i].id + '').find('.start_time').text(),
                            node_time.endtime = $('#' + vm.location[i].id + '').find('.end_time').text()
                        node_time.node_name = $('#' + vm.location[i].id + '').find('.node-title').text()
                        node_times.push(node_time)
                    }
                    var period = $('#period').val()
                    var template_list = vm.template_list
                    axios({
                        method: 'post',
                        url: '${SITE_URL}monitor_item/start_flow_task/',
                        data: {
                            'period': period,
                            'template_list': template_list,
                            'node_times': node_times,
                            'monitor_name': vm.monitor_name,
                            'monitor_type': vm.monitor_type,
                            'constants': vm.constants
                        }
                    }).then(function (res) {
                        setInterval(function () {
                            axios({
                                method: 'post',
                                url: '${SITE_URL}monitor_item/node_state/',
                                data: {
                                    'item_id': res.data
                                }
                            }).then(function (res) {
                                len = res.data.message.length
                                for (var i = 0; i <= len - 1; i++) {
                                    data_key = res.data.message[i].data_value
                                    if (data_key == '1' || data_key == '4') {
                                        $('p:contains(' + res.data.message[i].data_key + ')').parent().siblings('.node-icon').css('background', '#67c23a')
                                    } else if (data_key == '0' || data_key == '2' || data_key == '3') {
                                        $('p:contains(' + res.data.message[i].data_key + ')').parent().siblings('.node-icon').css('background', '#f56c6c')
                                    }
                                }
                            }).catch(function (e) {
                                vm.$message.error('获取数据失败！');
                            });
                        }, 13000)
                    }).catch(function (e) {
                        vm.$message.error('获取数据失败！');
                    });
                } else if (vm.liucheng == 'none') {
                    var period = $('#period').val()
                    var template_list = vm.template_list
                    axios({
                        method: 'post',
                        url: '${SITE_URL}monitor_item/flow_gather_test/',
                        data: {}
                    }).then(function () {
                    }).catch(function (e) {
                        vm.$message.error('获取数据失败！');
                    });
                }
            },
            add_unit(row) {   //新增监控项
                {
                    if (vm.add_pamas == 1) {
                        vm.Initialization()
                    }
                    vm.add_pamas = 0;
                    vm.monitor_name = '';
                    //取消默认添加时展示基本监控项
                    vm.disabled2 = false;
                    //vm.disabled3 = false;
                    //vm.disabled4 = false;
                    //vm.disabled5 = false;
                    //vm.monitor_type = 'first';
                    //默认添加时展示基本监控项（修改后）
                    //监控项类型设置
                    this.monitor_type = 'five';
                    //数据来源选项默认切换为接口
                    this.sql_file_interface = 9;
                    //采集参数gather_params默认置为interface
                    this.base['gather_params'] = 'interface';
                    //切换基本监控项的数据来源类型展示不同的内容，默认切换为接口
                    this.base_gather_source_change('interface');
                    //--------------------------
                    vm.unit_id = row;
                    vm.centerDialogVisible = true;
                    //取消原有基本监控项时默认加载数据库连接信息
                    this.get_db_connections();
                }
            },
            del() {
                vm.edit(0)
            },
            change1(value) {
                if (value == 3) {
                    vm.sql1 = 'block';
                    vm.file1 = 'none';
                    vm.interface1 = 'none';
                    vm.server_url = '';
                    vm.file_param = '';
                    vm.basic.gather_rule = '';
                    vm.basic.gather_params = 'sql';
                    //修改后的基本监控项的采集类型设置
                    vm.base.gather_params = 'sql';
                    //----------------------------
                } else if (value == 6) {
                    vm.typeid = '2';
                    vm.sql1 = 'none';
                    vm.file1 = 'block';
                    vm.interface1 = 'none';
                    vm.server_url = '';
                    vm.file_param = '';
                    vm.basic.gather_rule = '';
                    vm.basic.gather_params = 'file';
                    //修改后的基本监控项的采集类型设置
                    vm.base.gather_params = 'file';
                    //----------------------------
                } else if (value == 9) {
                    vm.typeid = '3';
                    vm.sql1 = 'none';
                    vm.file1 = 'none';
                    vm.interface1 = 'block';
                    vm.server_url = '';
                    vm.file_param = '';
                    vm.basic.gather_rule = '';
                    vm.basic.gather_params = 'interface';
                    //修改后的基本监控项的采集类型设置
                    vm.base.gather_params = 'interface';
                    //----------------------------
                }
            },
            change2(value) {
                if (value == 1) {
                    vm.zuoye = 'block';
                } else {
                    vm.zuoye = 'none';
                }
            },
            change3(value) {
                if (value == 1) {
                    vm.liucheng = 'block';
                } else {
                    vm.liucheng = 'none';
                }
            },
            change4() {
                if (vm.basic.score > 100) {
                    vm.basic.score = 100
                } else if (vm.base.score > 100) {
                    vm.base.score = 100
                }
            },
            change_job_fontSize() {       //修改作业单元中预览字体
                $('#job_text').find("*").css('font-size', this.job.font_size);
            },
            change_job_height() {       //修改作业单元中预览高度
                $('#job_text').css('height', this.job.height);
            },
            change_job_width() {       //修改作业单元中预览宽度
                $('#job_text').css('width', this.job.width);
            },
            change_job_contents() {       //作业单元显示内容
                let contents = vm.job.contents;
                let job_status = contents.split('@')[1].split('=')[1];
                let item_id = 'item_id'
                var job_params = {
                    'id': item_id,
                    'width': vm.job.width,
                    'height': vm.job.height,
                    'status': job_status,
                };
                $('#job_text').html('');
                $('#job_text').append('<div type=\"job' + item_id + '\" style=\"margin:0 auto;\"></div>');
                job_monitor_active(job_params);
            },
            job_test() {
                vm.disabled1 = true;
                setTimeout(function () {
                    vm.disabled1 = false;
                }, 3000);
                var job_params1 = {
                    'id': 'item_id',
                    'width': vm.job.width,
                    'height': vm.job.height,
                    'status': 2,
                };
                $('#job_text').html('');
                $('#job_text').append('<div type=\"jobitem_id\" style=\"margin:0 auto;\"></div>');
                job_monitor_active(job_params1);
                axios({
                    url: '${SITE_URL}monitor_item/job_test/',
                    method: 'post',
                    data: {
                        'gather_params': vm.job.gather_params,
                        'job_id': vm.job.gather_rule,
                        'params': vm.job.params,
                    },
                }).then((res) => {
                    let status = res['data']['result'];
                    let job_status = 0;
                    switch (status) {
                        case true:
                            job_status = 1;
                            console.log(1)
                            break;
                        case false:
                            job_status = -1;
                            console.log(-1)
                            break;
                        default:
                            job_status = 2;
                            console.log(2)
                    }
                    let item_id = 'item_id'
                    var job_params = {
                        'id': item_id,
                        'width': vm.job.width,
                        'height': vm.job.height,
                        'status': job_status,
                    };
                    $('#job_text').html('');
                    $('#job_text').append('<div type=\"job' + item_id + '\" style=\"margin:0 auto;\"></div>');
                    job_monitor_active(job_params);
                }).catch(function (e) {
                    vm.$message.error('获取数据失败！');
                });
            },
            rowclass({row, rowIndex}) {
                return 'background:#F7F7F7'
            },
            font_size() {        //修改流程单元中的表字体
                $("#canvas").find('*').css("font-size", this.flow.font_size)
            },
            flow_height() {      //修改流程单元中的高
                $("#canvas").find('*').css("height", this.flow.height)
            },
            flow_width() {       //修改流程单元中的宽
                $("#canvas").find('*').css("width", this.flow.height)
            },
            get_db_connections() {
                axios({
                    url: '${SITE_URL}db_connection/get_all_db_connection/',
                    method: 'post',
                }).then((res) => {
                    let json = [];
                    if (res.data.results.length > 0) {
                        for (let i = 0; i < res.data.results.length; i++) {
                            let j = {};
                            j.value = res.data.results[i].id;
                            j.label = res.data.results[i].connname;
                            json.push(j);
                        }
                        ;
                        this.sites1 = json;
                    }
                }).catch(function (e) {
                    vm.$message.error('获取数据失败！');
                });
            },
            //初始化
            Initialization() {
                Object.assign(vm.basic, {});
                Object.assign(vm.basic, vm.basic1);
                Object.assign(vm.job, {});
                Object.assign(vm.job, vm.job1);
                Object.assign(vm.flow, {});
                Object.assign(vm.flow, vm.flow7);
                Object.assign(vm.chart, {});
                Object.assign(vm.chart, vm.chart1);
                vm.server_url = '';
                vm.file_param = '';
                vm.sql_file_interface = 3
            },
            //显示图标
            show_chart() {
                if (this.myChart != null && this.myChart != "" && this.myChart != undefined) {
                    this.myChart.dispose();
                }
                if (vm.chart.gather_params == "饼图") {
                    this.myChart = echarts.init(document.getElementById('maintenancePie'), 'macarons');
                    let legendData = [];
                    for (let i = 0; i < vm.chartData.length; i++) {
                        this.$set(legendData, i, vm.chartData[i].name);
                    }
                    option = {
                        tooltip: {
                            trigger: 'item',
                            formatter: "{a} <br/>{b} : {c} ({d}%)"
                        },
                        legend: {
                            type: 'scroll',
                            orient: 'vertical',
                            right: 10,
                            bottom: 50,
                            data: legendData
                        },
                        series: [
                            {
                                name: vm.person_count,
                                type: 'pie',
                                radius: '50%',
                                center: ['50%', '30%'],
                                data: vm.chartData,
                                itemStyle: {
                                    emphasis: {
                                        shadowBlur: 10,
                                        shadowOffsetX: 0,
                                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                                    }
                                },
                                avoidLabelOverlap: false,
                                label: {
                                    normal: {
                                        show: true,
                                        position: 'inside',
                                        formatter: '{c}'
                                    }
                                },
                                labelLine: {
                                    normal: {
                                        show: false
                                    },
                                    emphasis: {
                                        show: true
                                    }
                                }
                            }
                        ]
                    };
                    this.myChart.setOption(option);
                }
                if (vm.chart.gather_params == "柱状图") {
                    this.myChart = echarts.init(document.getElementById('maintenancePie'), 'macarons');
                    let barX = [];
                    let barCount = [];
                    for (var i = 0; i < vm.chartData.length; i++) {
                        this.$set(barX, i, vm.chartData[i].name);
                        this.$set(barCount, i, vm.chartData[i].value);
                    }
                    option = {
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                                type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                            }
                        },
                        barWidth: 15,
                        legend: {
                            data: ['已执行'],
                            bottom: 10,
                            right: 30
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            top: 10,
                            containLabel: true
                        },
                        xAxis: {
                            type: 'category',
                            data: barX
                        },
                        yAxis: {
                            type: 'value'
                        },
                        series: [
                            {
                                name: vm.person_count,
                                type: 'bar',
                                data: barCount
                            },
                        ]
                    };
                    this.myChart.setOption(option);
                }
                if (vm.chart.gather_params == "折线图") {
                    this.myChart = echarts.init(document.getElementById('maintenancePie'), 'macarons');
                    let lineX = [];
                    let lineCount = [];
                    for (var i = 0; i < vm.chartData.length; i++) {
                        this.$set(lineX, i, vm.chartData[i].name);
                        this.$set(lineCount, i, vm.chartData[i].value);
                    }
                    option = {
                        tooltip: {
                            trigger: 'axis'
                        },
                        legend: {
                            data: [vm.person_count]
                        },
                        calculable: true,
                        xAxis: [
                            {
                                type: 'category',
                                boundaryGap: false,
                                data: lineX
                            }
                        ],
                        yAxis: [
                            {
                                type: 'value'
                            }
                        ],
                        series: [
                            {
                                name: vm.person_count,
                                type: 'line',
                                smooth: true,
                                itemStyle: {normal: {areaStyle: {type: 'default'}}},
                                data: lineCount
                            },
                        ]
                    };
                    this.myChart.setOption(option);
                }
                vm.echart_height();
                vm.echart_width();
            },
            show_content() {
                let content = vm.chart.contents;
                let obj = JSON.parse(content);
                let echartData = [];
                for (let i = 0; i < obj.X.v.length; i++) {
                    let obj_1 = {};
                    obj_1.name = obj.X.v[i];
                    obj_1.value = obj.Y.v[i];
                    this.$set(echartData, i, obj_1);
                }
                vm.chartData = echartData;
                vm.show_chart();
                vm.echart_height();
                vm.echart_width();
            },
            chart_get_test() {
                //20190508 彭英杰 处理图表显示 start
                var tab = $("div[role='tablist']");
                if (tab.length > 0) { //判断是否存在
                    var ar_tab = tab.find("div[aria-selected='true']");
                    if (ar_tab.length > 0) {//判断是否选择
                        var id = ar_tab[0].id;
                        if (id == "tab-second") {//为图表监控项
                            //pane-second
                            // maintenancePie 展示页面
                            //required
                            //vm.chart.gather_rule
                            if (vm.chart.gather_rule != "") {
                                $("#pane-second maintenancePie").load(vm.chart.gather_rule)
                            }
                            return;
                        }
                    }
                }

                //20190508 彭英杰 处理图表显示 end
                axios({
                    url: '${SITE_URL}monitor_item/chart_get_test/',
                    method: 'post',
                    data: {
                        database_id: vm.chart.params,
                        sql: vm.chart.gather_rule,
                    },
                }).then((res) => {
                    if (res.data.result) {
                        this.$message({
                            message: '数据采集成功，请选择图表类型进行查看！',
                            type: 'success',
                            center: true
                        })
                    } else {
                        this.$message({
                            message: '数据采集失败，请检查数据配置或采集规则！',
                            type: 'warning',
                            center: true
                        })
                    }
                    vm.chartData = res.data.results;
                    vm.person_count = res.data.column_name_list[0];
                    vm.show_chart();
                    vm.echart_height();
                    vm.echart_width();
                }).catch(function (e) {
                    vm.$message.error('获取数据失败！');
                });
            },
            echart_height() {
                $('#maintenanceIndex').find("canvas").css('height', vm.chart.height);
            },
            echart_width() {
                $('#maintenanceIndex').find("canvas").css('width', vm.chart.width)
            },
            base_height_change() {
                collection_base_height_change(vm, '#base_test_text');
            },
            base_width_change() {
                collection_base_width_change(vm, '#base_test_text');
            },
            switch_change(value) {
                axios({
                    method: 'post',
                    url: '${SITE_URL}monitor_item/change_status/',
                    data: {
                        flag: value.status,
                        id: value.id,
                        monitor_name: value.monitor_name
                    },
                }).then((res) => {
                    if (res.data.code == 1) {
                        alert(res.data.message)
                    }
                }).catch(function (e) {
                    vm.$message.error('获取数据失败！');
                });
            },
            //获取指标集
            get_gather_info(value) {
                this.base.measures = '';
                this.base.measures_name = '';
                vm.iqube_name = [];
                //日志监控项模拟数据,目前一体化平台没有数据
                if ("get_log_type/" == value) {
                    var temp_json = {'label': 'zy-shangpin-initial', 'value': 'zy-shangpin-initial'};
                    vm.iqube_name.push(temp_json)
                } else {
                    vm.loading = true;
                    axios({
                        url: '${SITE_URL}iqube_interface/' + value,
                    }).then((res) => {
                        vm.gather_list = res.data.results;
                        for (let i = 0; i < res.data.results.length; i++) {
                            // 第一个
                            for (let j in res.data.results[i]) {
                                temp_json = {'label': j, 'value': j};
                                vm.iqube_name.push(temp_json)
                            }
                        }
                        //在第一次编辑的情况下，根据当前来源名称加载对应的候选度量值
                        if ('1' == vm.add_pamas && vm.loading == true) {
                            this.change_measures(vm.base['measures']);
                        }
                        vm.loading = false;
                    }).catch((res) => {
                        console.error("获取指标集失败" + res);
                        vm.loading = false;
                    });
                }
            },
            //获取指标名称
            change_measures(value) {
                //base_monitor_edit_init默认为true代表处于点击编辑后的数据初始化后的状态，
                //这种情况下不会清除其初始化好的度量值。如果不是数据初始化后的状态，
                // 而是通过手动点击来源名称下拉框的形式调用此函数，
                // 将会清空其度量值，避免在改变来源名称之后还是原来的度量值名称，
                // 导致度量值候选项中末尾出现暂无数据的BUG
                if (null != vm.base['measures_name'] || vm.base['measures_name'] != '') {
                    if (!this.base_monitor_edit_init || !this.base_monitor_add_init) {
                        vm.base['measures_name'] = '';
                    }
                }
                //日志监控项模拟数据
                if (this.base.interface_type == 'log') {
                    vm.metric_list = {0: 'system-init'};
                }
                //如果是点击编辑后的数据初始化时触发的此函数，base_monitor_edit_init标记
                //置为false，在下次触发change_measures函数时将清空度量值
                if (this.base_monitor_edit_init) {
                    if ('1' == vm.add_pamas) {
                        this.base_monitor_edit_init = false;
                    } else if ('0' == vm.add_pamas) {
                        this.base_monitor_add_init = false;
                    } else {
                        console.log('触发类型不是添加/修改！')
                    }
                }
                for (let i in vm.gather_list) {
                    for (let key in vm.gather_list[i]) {
                        if (key === value) {
                            vm.metric_list = vm.gather_list[i][key]['metric_list']
                            vm.dimension_list = vm.gather_list[i][key]['dimension_list']
                        }
                    }
                }
                console.log(vm.dimension_list);
            },
            //切换来源类型
            change_source_type(value) {
                if (value == 'log') {
                    vm.get_gather_info('get_log_type/')
                } else {
                    vm.get_gather_info('get_measures_type/')
                }
            },
            //采集测试方法
            base_cell_test() {
                //同步获取采集数据
                vm.get_gather_test();
                //预览采集，调用预览组件
                preview_monitor_item(vm, 'monitor_item', "#base_test_text");
                base_monitor_show_reset();
            },
            change_data_sources(value) {
                if (value == 9) {
                    //接口类型
                    vm.file_show = false;
                    vm.interface_show = true;
                    vm.database_show = false;
                    vm.change1(9);
                } else if (value == 6) {
                    //文件
                    vm.file_show = true;
                    vm.interface_show = false;
                    vm.database_show = false;
                    vm.change1(6);
                } else if (value == 3) {
                    //数据库
                    vm.change1(3);
                    vm.file_show = false;
                    vm.interface_show = false;
                    vm.database_show = true;
                }
            },
            // 预览类容编辑
            // 采集表中保存的是实际调用一体化平台的返回的结果，在场景编排中再根据展示规则还原预览效果
            content_change() {
                collection_content_change(vm, "#base_test_text")
            },
            //jlq-2019-05-16-add
            //监控项名称不重复
            monitorName(){
                axios({
                    method: 'post',
                    url: '${SITE_URL}monitor_item/verify_name_only/',
                    data:{
                        name:vm.monitor_name,
                        id:vm.unit_id
                    }
                }).then(function (res) {
                    //flag=res.message
                    //alert(res);
                    console.log(res);
                    if(res.data.message == false){
                      //  alert('111');
                       // new Error('监控项名称不能重复')
                       //vm.message = '监控项名称不能重复';
                      // this.$alert(vm.message, "错误");
                        vm.isShow = true;
                    }else{
                        vm.isShow = false;
                    }
                }).catch(function (e) {
                    vm.$message.error('获取数据失败！');
                });
            }

        },
        mounted() {
            this.get_header_data()
            this.get_all_area()
        },
        watch: {
            'basic.gather_rule': function (oldval, newval) {//展示内容探测狗
                fs = oldval.split('@')
                vm.fields = []
                for (var i = 1; i < fs.length; i += 2) {
                    vm.fields.push(fs[i].split("=")[0])
                }
            },
            "monitor_type":function(value){//tab页切换探测狗
               if(value == "first"){
                   //vm.change1(3);
                   vm.sql_file_interface = 3
               }
               if(value == "five"){
                   //vm.change_data_sources(9);
                   vm.sql_file_interface = 9
               }
            }
        }
    });
    vm.show();

</script>
<script>
    setInterval(function () {
        $('input[type=number]').keypress(function (e) {
            if (!String.fromCharCode(e.keyCode).match(/[0-9\.]/)) {
                return false;
            }
        });
    }, 1)
    $(function () {
    })
</script>
</html>