<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- 开发环境版本，包含了有帮助的命令行警告--2.5.51 ${STATIC_URL}assets/-->
    <script src="${STATIC_URL}assets/vue-2.5.21/vue.development.js"></script>
    <!-- 生产环境版本，优化了尺寸和速度 功能完善后请将vue.development.js该为vue.js-->
    <!--<script src="${STATIC_URL}assets/vue-2.5.21/vue.js"></script>-->
    <!-- element UI引入样式 -->
    <link href="${STATIC_URL}assets/element-2.4.11/index.css" rel="stylesheet">
    <!-- element UI引入组件库 -->
    <script src="${STATIC_URL}assets/element-2.4.11/index.js"></script>
    <!-- vue的ajax依赖-->
    <script src="${STATIC_URL}assets/vue-2.5.21/axios.min.js"></script>
    <!--jQuery库使用时请使用标准jQuery语法-->
    <!--<script src="${STATIC_URL}assets/jquery/jquery-3.1.1.min.js"></script>-->
    <!--页面初始化css(Tencent)-->
    <link href="${STATIC_URL}css/common/init.css" rel="stylesheet">
    <!--本页面css-->
    <link href="${STATIC_URL}css/common/main.css" rel="stylesheet">
    <!--阿里巴巴矢量图标库--项目完成后请下载css并下载css引用的字体文件-->
    <link href="http://at.alicdn.com/t/font_997278_ptr5bdmor4j.css" rel="stylesheet">
    <!--以下为后台参数-->
    <!--
    "${SITE_URL}";	        // app的url前缀,在ajax调用的时候，应该加上该前缀
    "${STATIC_URL}";       // 静态资源前缀
    **/--->
    <script src="https://magicbox.bk.tencent.com/static_api/v3/assets/js/jquery-1.10.2.min.js"></script>
    <link rel="stylesheet" href="https://magicbox.bk.tencent.com/static_api/v3/assets/bk-icon-2.0/iconfont.css">
    <script type="text/javascript" src="https://magicbox.bk.tencent.com/static_api/v3/assets/dataflow-2.0/js/jsplumb.min.js"></script>
    <link rel="stylesheet" href="https://magicbox.bk.tencent.com/static_api/v3/assets/dataflow-2.0/css/jsPlumbToolkit-defaults.css" />
    <script type="text/javascript" src="${STATIC_URL}js/dataflow/dataflow.js"></script>
     <link rel="stylesheet" href="${STATIC_URL}css/monitorScene/dataflow-index.css">
</head>
<body>
<div id="main">
    <template>
        <div class="block">
            <!--<span class="demonstration">Click 指示器触发</span>-->

            <el-carousel trigger="click" :height="imgHeight">
                <el-carousel-item v-for="item in imgList" :key="item.id">
                    <el-row>
                        <div id="flow1" class="clearfix workflow-box" style="width: 100%">

                                        <div class="workflow-canvas" style="margin-left: 0px;padding-left: 0px">
                                            <!-- 画布模板 start -->
                                            <div class="jtk-content">
                                                <div class="jtk-demo-canvas canvas-wide jtk-surface jtk-surface-nopan"
                                                     id="canvas" style="height:370px;">
                                                    <!-- 流程 -->
                                                </div>
                                            </div>
                                            <!-- 画布模板 end -->

                                        </div>

                                        <!-- template 模板-->
                                        <div class="jtk-delete jtk-none ">删除节点</div>
                                        <div id="template" class="jtk-none">
                                            <div class="jtk-window jtk-node workfolw-node start-node" id="{charts}"
                                                 data-type="start">
                                                <div class="node-wrapper">
                                                    <div class="node-icon-start">
                                                        <i class="bk-icon icon-star-shape"></i>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="jtk-window jtk-node workfolw-node database-node" id="{charts}"
                                                 data-type="database">
                                                <div class="node-wrapper">
                                                    <div class="node-content">
                                                        <input type="text" class="node-title" value="">
                                                        <p data="数据源" class="node-desc">一级分析</p>
                                                    </div>
                                                    <div class="node-icon">
                                                        <i class="bk-icon icon-data"></i>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="jtk-window jtk-node workfolw-node cog-node" id="{charts}"
                                                 data-type="dataCog">
                                                <div class="node-wrapper">
                                                    <div class="node-content">
                                                        <input type="text" class="node-title" value="">
                                                        <p data="数据源" class="node-desc">实时加载</p>
                                                    </div>
                                                    <div class="node-icon">
                                                        <i class="bk-icon icon-cog"></i>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="jtk-window jtk-node workfolw-node filter-node" id="{charts}"
                                                 data-type="dataFilter">
                                                <div class="node-wrapper">
                                                    <div class="node-content">
                                                        <input type="text" class="node-title" value="">
                                                        <p data="数据源" class="node-desc">离线计算</p>
                                                    </div>
                                                    <div class="node-icon">
                                                        <i class="bk-icon icon-circle"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                        <el-col :span="24"><img ref="imgHeight" :src="item.idView" class="banner_img"/></el-col>
                    </el-row>
                </el-carousel-item>
            </el-carousel>
        </div>
    </template>
</div>

<script>
    axios.interceptors.request.use((config) => {
        config.headers['X-Requested-With'] = 'XMLHttpRequest';
        let regex = /.*csrftoken=([^;.]*).*$/; // 用于从cookie中匹配 csrftoken值
        config.headers['X-CSRFToken'] = document.cookie.match(regex) === null ? null : document.cookie.match(regex)[1];
        return config
    });
    let vm = new Vue({
        el: "#main",
        data: {
            imgList: [],
            imgHeight: ''+document.documentElement.clientHeight+'px',
        },
        methods: {
            get_scenes(){
                 axios({
                    method: 'post',
                    url: '${SITE_URL}monitorScene/alternate_play/',
                }).then((res)=> {
                    console.log(res)
                     vm.imgList = res.data.message;
                })
                 }
        },
        mounted() {
            //const that = this
            //这里很关键；大部分博客都是这样写的，其实也没有毛病，只不过有时候不起作用；
            window.onresize = () => {
                return (() => {
                    window.imgHeight = document.documentElement.clientHeight;
                    this.imgHeight = ''+window.imgHeight+'px';
                })()
            }

        },
        watch:{
            imgHeight (val) {
                if (!this.timer) {
                    this.imgHeight = val;
                    this.timer = true;
                    let that = this;
                    setTimeout(function () {
                        // that.screenWidth = that.$store.state.canvasWidth
                        console.log(that.imgHeight);
                        that.timer = false;
                    }, 400)
                }
            },
        }
    });
    vm.get_scenes()

</script>
<script>
    setInterval(function () {


        //flow1_js_start
        $('#flow1').dataflow({
            el: '.tool', //流程拖动源
            canvas: '#canvas', //画布
            arrowWidth: 8,
            arrowHeight: 10,
            template: '#template',
            id: 'ch', // 定义节点id，当页面只有一个dataflow实例是可忽略，当有多个实例时，需自定义该字段，id具有唯一性
            onRemoveNodeAfter: function(id, line) { //删除节点回调
                //console.log(id);
                //console.log(line);
            },
            onCreateNodeAfter: function(id) { //初始化节点回调
                //console.log(id)
            },
            onCreateLineAfter: function() { //创建线条后回调
                //console.log("1111")
            },
            ondrawData: function() { //初始化流程后回调
                //console.log($('.node-icon').length)
            },
            data: {
                "line": [
                    {
                    "source": {
                        "id": "ch1",
                        "arrow": "Bottom"
                    },
                    "target": {
                        "id": "ch3",
                        "arrow": "Left"
                    }
                    },
                    {
                        "source": {
                            "id": "ch2",
                            "arrow": "Right"
                        },
                        "target": {
                            "id": "ch3",
                            "arrow": "Right"
                        }
                    },
                    {
                        "source": {
                            "id": "ch3",
                            "arrow": "Top"
                        },
                        "target": {
                            "id": "ch2",
                            "arrow": "Bottom"
                        }
                    },
                    {
                        "source": {
                            "id": "ch3",
                            "arrow": "Top"
                        },
                        "target": {
                            "id": "ch2",
                            "arrow": "Right"
                        }
                    },
                    {
                        "source": {
                            "id": "ch3",
                            "arrow": "Top"
                        },
                        "target": {
                            "id": "ch4",
                            "arrow": "Right"
                        }
                    },
                    ],
                "location": [
                    {
                        "id": "ch1",
                        "x": 130,
                        "y": 48,
                        "name":"1",
                        "type": "database"
                    },
                    {
                        "id": "ch2",
                        "x": 406,
                        "y": 33,
                        "name":"2",
                        "type": "dataCog"
                    },
                    {
                        "id": "ch3",
                        "x": 406,
                        "y": 243,
                        "name":"3",
                        "type": "dataCog"
                    },
                    {
                        "id": "ch4",
                        "x": 150,
                        "y": 60,
                        "name":"4",
                        "type": "database"
                    },
                ]
            }
        });
        $('#save2').click(function() {
            // 获取全部数据
            var data= $('#flow1').data('dataflow').getAllData();
            var name = data.location[0];
            $('#result2').val(JSON.stringify(data));
        });

        // 清空画布
        $('#resetCanvas').click(function() {
            $('#flow1').data('dataflow').resetCanvas();
        });
        //flow1_js_end
        // $('.node-wrapper').click(function () {
        //
        //     $(this).find(".node-title").attr('contenteditable','plaintext-only');
        // })
        //节点抽屉
        $('.tool-title').click(function () {
            $(this).next('.tool-list').animate({
                height:'toggle'
            });
            $(this).parent().siblings().children('.tool-list').animate({
                height:"hide"
            });
        });

    },1)
</script>

<!--暂时的css样式-->
<style>
    .el-carousel__item h3 {
        color: #475669;
        font-size: 14px;
        opacity: 0.75;
        line-height: 150px;
        margin: 0;
    }

    .el-carousel__item:nth-child(2n) {
        background-color: #99a9bf;
    }

    .el-carousel__item:nth-child(2n+1) {
        background-color: #d3dce6;
    }
</style>
</body>
</html>