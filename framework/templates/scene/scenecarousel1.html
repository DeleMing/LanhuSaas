<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- 开发环境版本，包含了有帮助的命令行警告--2.5.51 ${STATIC_URL}assets/-->
    <script src="${STATIC_URL}assets/vue-2.5.21/vue.development.js"></script>
    <!-- 生产环境版本，优化了尺寸和速度 功能完善后请将vue.development.js该为vue.js-->
    <!--<script src="${STATIC_URL}assets/vue-2.5.21/vue.js"></script>-->
    <!-- element UI引入样式 -->
    <link href="${STATIC_URL}assets/element-2.4.11/index.css" rel="stylesheet">
    <!-- element UI引入组件库 -->
    <script src="${STATIC_URL}assets/element-2.4.11/index.js"></script>
    <!-- vue的ajax依赖-->
    <script src="${STATIC_URL}assets/vue-2.5.21/axios.min.js"></script>
    <!--jQuery库使用时请使用标准jQuery语法-->
    <!--<script src="${STATIC_URL}assets/jquery/jquery-3.1.1.min.js"></script>-->
    <!--页面初始化css(Tencent)-->
    <link href="${STATIC_URL}css/common/init.css" rel="stylesheet">
    <!--本页面css-->
    <link href="${STATIC_URL}css/common/main.css" rel="stylesheet">
    <!--阿里巴巴矢量图标库--项目完成后请下载css并下载css引用的字体文件-->
    <link href="http://at.alicdn.com/t/font_997278_ptr5bdmor4j.css" rel="stylesheet">
    <!--以下为后台参数-->
    <!--
    "${SITE_URL}";	        // app的url前缀,在ajax调用的时候，应该加上该前缀
    "${STATIC_URL}";       // 静态资源前缀
    **/--->
</head>
<body style="height: 100%">
<div id="main">
    <el-menu

            class="el-menu-demo"
            mode="horizontal"
            background-color="#fafafa"
            text-color="#fff"
            active-text-color="#ffd04b">
        <el-form :inline="true" class="demo-form-inline" style="margin-top: 15px;">

            <el-form-item label="员工名称:" size="mini"  prop="users">
                <el-select v-model="users" placeholder="请选择员工" >
                    <el-option v-for="item in options" :label="item.label" :key="item.value"
                               :value="item.value"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="起始时间:" size="mini">
                <el-time-picker v-model="start" placeholder="开始时间点" format="HH:mm" value-format="HH:mm" >
                </el-time-picker>
                <el-time-picker v-model="end" placeholder="结束时间点" format="HH:mm" value-format="HH:mm" >
                </el-time-picker>
            </el-form-item>
            <el-button type="info" v-on:click="alternate_play_test">测试</el-button>
        </el-form>
    </el-menu>
    <template>
        <div class="block">
            <!-- 选择员工信息 strat -->
            <div style="width: 100%;">

            </div>
            <!-- 选择员工信息 end -->
            <!--<span class="demonstration">Click 指示器触发</span>-->

            <el-carousel trigger="click" :change="scene_change" :height="imgHeight">
                <el-carousel-item v-for="item in imgList" :key="item.id">
                    <el-row>
                        <el-col :span="24">
                            <div ref="imgHeight" :src="item.idView" class="'scene_content'+item.id">
                            </div>
                        </el-col>

                    </el-row>
                </el-carousel-item>
            </el-carousel>
        </div>
    </template>
</div>

<script>
    axios.interceptors.request.use((config) => {
        config.headers['X-Requested-With'] = 'XMLHttpRequest';
        let regex = /.*csrftoken=([^;.]*).*$/; // 用于从cookie中匹配 csrftoken值
        config.headers['X-CSRFToken'] = document.cookie.match(regex) === null ? null : document.cookie.match(regex)[1];
        return config
    });
    let vm = new Vue({
        el: "#main",
        data: {
            imgList: [],
            imgHeight: '' + document.documentElement.clientHeight + 'px',
            start: '09:00',                                                                   //开始时间
            end: '18:00',                                                                   //结束时间
            region1: '1',                                                                 //岗位选择
            users: 'admin',                                                                  //员工选择
            options: [],
        },
        methods: {
            get_user(){
                 axios({
                    method: 'post',
                    url: '${SITE_URL}monitorScene/get_all_user/',
                }).then((res)=> {
                    let json = [];
                    if (res.data.message.length > 0) {
                        for (var i = 0; i < res.data.message.length; i++) {
                            let j = {};
                            j.value = res.data.message[i];
                            j.label = res.data.message[i];
                            json.push(j);
                        };
                        this.options = json;
                    }
                }).catch((res) => {
                    console.log('获取用户错误')
                })
            },
            alternate_play_test(){
                 axios({
                    method: 'post',
                    url: '${SITE_URL}monitorScene/alternate_play_test/',
                     data :{
                        'user_name':vm.users,
                         'start':vm.start,
                         'end':vm.end
                     }
                }).then((res)=> {
                     vm.imgList = res.data.message;
                     console.log(vm.imgList)
                 })
            },
            scene_change(value1,value2){
                vm.scene_content_change(value1);
            },
            scene_content_change(value){
                console.log(value);
            },
        },
        mounted() {
            //const that = this
            //这里很关键；大部分博客都是这样写的，其实也没有毛病，只不过有时候不起作用；
            window.onresize = () => {
                return (() => {
                    window.imgHeight = document.documentElement.clientHeight - 100;
                    vm.imgHeight = '' + window.imgHeight + 'px';
                })()
            }

        },
        watch: {
            imgHeight(val) {
                if (!this.timer) {
                    this.imgHeight = val;
                    this.timer = true;
                    let that = this;
                    setTimeout(function () {
                        // that.screenWidth = that.$store.state.canvasWidth
                        console.log(that.imgHeight);
                        that.timer = false;
                    }, 400)
                }
            },
        }
    });

    vm.get_user();
</script>


<!--暂时的css样式-->
<style>
    .el-carousel__item h3 {
        color: #475669;
        font-size: 14px;
        opacity: 0.75;
        line-height: 150px;
        margin: 0;
    }

    .el-carousel__item:nth-child(2n) {
        background-color: #99a9bf;
    }

    .el-carousel__item:nth-child(2n+1) {
        background-color: #d3dce6;
    }
</style>
</body>
</html>